{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue","webpack:///./src/LineCollection.js","webpack:///./src/Turtle.js","webpack:///./src/LSystem.js","webpack:///./src/createScene.js","webpack:///./src/grammar/parser.js","webpack:///./src/getCodeModel.js","webpack:///./src/CodeEditor.vue","webpack:///./src/bus.js","webpack:///src/CodeEditor.vue","webpack:///./src/CodeEditor.vue?944a","webpack:///./src/CodeEditor.vue?7f42","webpack:///src/App.vue","webpack:///./src/App.vue?98c8","webpack:///./src/App.vue?bff9","webpack:///./src/NoWebGL.vue","webpack:///./src/NoWebGL.vue?ff1f","webpack:///./src/main.js","webpack:///./src/NoWebGL.vue?20c6","webpack:///./src/App.vue?03c4","webpack:///./src/lmode.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","render","_vm","this","_c","_self","class","isLightTheme","attrs","staticClass","sidebarOpen","on","toggleSidebar","_v","_s","toggleTheme","_m","syntaxHelpVisible","_e","$event","preventDefault","codeEditorModel","directives","rawName","lineWidth","expression","modifiers","domProps","updateLineWidth","_n","target","$forceUpdate","showGrid","Array","isArray","_i","$$a","$$el","$$c","checked","$$v","$$i","concat","toggleGrid","rotation","updateRotation","pickFromAlbum","arguments","trueRandomize","stopGeneration","toSVGFile","_l","examples","example","index","currentExampleIndex","loadExample","showSelectionMask","style","left","selectionRect","top","width","height","startDrag","stopPropagation","startResize","confirmSelection","cancelSelection","showSaveModal","saveSVGVersion","staticRenderFns","LineCollection","GLCollection","constructor","gl","options","program","defineProgram","vertex","fragment","attributes","color","ColorAttribute","instanced","point","InstancedAttribute","super","multiColorSegment","draw","_","drawContext","uniforms","modelViewProjection","resolution","forEachLine","cb","count","getCount","from","x","y","z","to","getLineColor","Turtle","scene","position","checkArray","direction","normalize","lines","getGL","capacity","appendChild","stack","invertZYAngle","pop","state","dispose","removeChild","move","distance","add","renderFrame","setColor","newColorValue","undefined","Error","rgba","tinycolor","values","names","toRgb","g","b","a","rotateZ","angleInDegrees","rad","Math","PI","cos","sin","rotateY","rotateX","swapAngle","arrayName","array","arr","hypot","LIMIT","LSystem","systemSettings","coerceTypes","rules","actions","compileActions","turtle","stepsPerFrame","drawQueue","lastDrawnIndex","depth","Number","isFinite","start","keys","simulate","iterator","renderIterator","frame","next","steps","done","production","iterateRules","complete","rule","op","rewriteRule","join","lSystem","defaultRotationAngle","angle","mergedActions","args","forEach","turtleAction","turtleCanDo","command","indexOf","getLength","match","system","parseFloat","createLScene","canvas","createScene","camera","allowRotation","allowPinchRotation","guide","setClearColor","initialSceneSize","currentViewBox","right","bottom","setViewBox","disposeLater","canDrawMore","raf","requestAnimationFrame","defaultColor","defaultLineWidth","currentTheme","gridColor","setSystem","saveToSVG","isComplete","stop","setTheme","setLineWidth","setGridVisible","getScene","fileName","customViewBox","originalViewBox","svgOptions","open","scale","svg","toSVG","replace","blob","Blob","type","url","URL","createObjectURL","setTimeout","document","createElement","href","download","click","revokeLater","revokeObjectURL","newSystem","cancelAnimationFrame","every","drawSystem","isLight","createGuide","lineColor","showCursor","visible","separator","ws","numericKey","vectorKey","parens","ExpectRewriteValue","addTo","parent","valueParser","process","line","split","trim","v","extractAction","stringValue","map","extractStringValue","matchedString","ExpectKeyValue","parseVector","vectorName","component","parse","str","currentState","lineNumber","startsWith","e","message","queryState","require","qs","code","getInitialCode","useSearch","standardCollection","getCodeModel","model","setCode","error","randomize","getExamples","lastPickedIndex","pickRandomIndex","ignoreNextUpdate","floor","random","getRandomSystem","colors","getRandomColors","useColors","X","Y","actionChar","String","fromCharCode","newCode","parseExpression","axiom","set","states","res","lastCh","ch","pickChar","reverse","colorPalettes","palette","numColors","ref","viewportMargin","Infinity","theme","callback","$set","bus","eventify","CodeMirror","toggleComment","cm","indent","lineComment","handleUp","handleDown","updateValueIfNeededBy","delta","doc","props","components","codemirror","mounted","beforeDestroy","watch","clearTimeout","clearImmediate","isImmediate","methods","setImmediateUpdate","refreshEditor","isCollapsed","CodeEditor","isDragging","isResizing","resizeHandle","dragStartPos","getCustomViewBox","localStorage","updateBodyBackground","rect","handleMouseMove","handleMouseUp","script","Vue","config","productionTip","canRender","isWebGLEnabled","querySelector","h","App","NoWebGL","$mount","defineMode","parserConfig","indentUnit","statementIndent","jsonMode","json","isTS","lsystem","typescript","wordRE","wordCharacters","ruleCharRE","keywords","kw","nope","test","content","isOperatorChar","readRegexp","stream","escaped","inSet","ret","tp","cont","tokenBase","tokenize","tokenString","eat","tokenComment","skipToEnd","expressionAllowed","current","tokenQuasi","peek","eatWhile","lexical","word","lastType","propertyIsEnumerable","arrow","string","quote","maybeEnd","brackets","findFatArrow","fatArrowAt","exec","sawSomething","pos","charAt","bracket","atomicTypes","JSLexical","indented","column","align","prev","info","inScope","varname","localVars","cx","context","vars","parseJS","cc","marked","combinator","statement","lex","pass","inList","list","register","block","newContext","registerVarScoped","Var","globalVars","inner","Context","isModifier","defaultVars","pushcontext","pushblockcontext","popcontext","pushlex","outer","poplex","expect","wanted","exp","vardef","parenExpr","maybeexpression","maybeelse","functiondef","forspec","className","enumdef","typename","typeexpr","pattern","maybelabel","maybeCatchBinding","afterExport","afterImport","funarg","expressionInner","expressionNoComma","noComma","body","arrowBodyNoComma","arrowBody","commasep","maybeop","maybeoperatorNoComma","maybeoperatorComma","classExpression","arrayLiteral","contCommasep","objprop","quasi","maybeTarget","me","expr","backUp","continueQuasi","targetNoComma","maybeTypeArgs","getterSetter","afterprop","maybetype","what","end","sep","proceed","maybetypeOrIn","mayberettype","isKW","afterType","typeprop","typearg","maybeReturnType","functiondecl","typeparam","maybeTypeDefault","maybeAssign","vardefCont","eltpattern","proppattern","_type","forspec1","forspec2","classNameAfter","classBody","classfield","isInterface","maybeFrom","exportField","importSpec","maybeMoreImports","maybeAs","enummember","isContinuedStatement","textAfter","startState","basecolumn","token","sol","indentation","eatSpace","Pass","firstChar","closing","doubleIndentSwitch","electricInput","blockCommentStart","blockCommentEnd","blockCommentContinue","fold","closeBrackets","helperType","jsonldMode","skipExpression","registerHelper","defineMIME","jsonld"],"mappings":"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,eAEAja,OACA,OACAiF,qBACAX,eACAO,qBACAsC,uBACAH,YACA7C,gBACA8D,iBACAZ,qBACAG,eAAAD,SAAAE,QAAAC,UAAAC,YACAuS,cACAC,cACAC,kBACAC,cAAArQ,IAAAC,KACA7E,YACAQ,YACAY,aAGA+S,UACA,yCACA,gBAGA,cAGA,sCACA,cACA,sBAIA,uCAGA,4BAGA,mCACA,6DACAnN,8BAIAwG,4DACAA,yDAEA4G,gBACA,qBACA5G,+DACAA,4DAEAiH,SACA/S,YAEA,0BACA,qBACA,oBACAS,aACAE,YACAC,UACAC,YAEA,2BAEAO,kBACA,0BAGA,0BAEA,aACA,oBACA,wBACA,yDAEA,6CACA,GACAyK,gBACA,wBACA,yDACA,MAEA,YACA,oBACA,wBACA,yDAEA,4CACA,GACAA,gBACA,wBACA,yDACA,MAEA,aAEA,oBACA,wBACA,yDAEA,4CAGAA,gBACA,wBACA,wDACA,6CAGA,GACAA,gBACA,wBACA,yDACA,MAEA,MAGA,uBAEA2H,mBAEA,8BAGA,uBACA,wBACA,wBAEA,uBACA,iDACA,kDAGA,OACA/S,SACAE,QACAgJ,UACAC,aAGAlM,gBACA,oCAEAkC,gBACA,yCACA,4BAEAE,gBACA,qCACA,6BAEAQ,eACA,2BACA,qCAEAP,iBACA,YACA,mBAGAlC,cACA,qCACA4V,+DACA,aACA,uCACA,4BAEA,iDACA,0DAIAC,uBAGA5H,2EAEApN,kBACA,8DACA,wCACA,0DAGAe,aACA,YACA,0CAGAE,iBACA,cAEA,4DAGAmB,aACA,mBACA,mBACAoC,oCACAC,qCAGAnC,iBACA,mBACA,oBACA,mBACAkC,YACAC,YACAwQ,SAAA,sBAGAC,mBACA,mBACA,sDACA,0DACA,oBACA,sCACA,gCACA,yBAEA,0BACA,SACA,iCACA,+BACA,mCACA,qCACA,MACA,SACA,+BACA,mCACA,qCACA,MACA,SACA,iCACA,mCACA,qCACA,MACA,SACA,mCACA,qCACA,MACA,QACA,+BACA,qCACA,MACA,QACA,qCACA,MACA,QACA,iCACA,mCACA,MACA,QACA,mCACA,MAIA,2D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","file":"js/app.f3226219.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/L-systems/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{class:{\"light-theme\": _vm.isLightTheme},attrs:{\"id\":\"app\"}},[_c('button',{staticClass:\"sidebar-toggle\",class:{\"sidebar-open\": _vm.sidebarOpen},on:{\"click\":_vm.toggleSidebar}},[_c('span',{staticClass:\"toggle-icon\"},[_vm._v(_vm._s(_vm.sidebarOpen ? '' : ''))])]),_c('button',{staticClass:\"theme-toggle\",attrs:{\"title\":_vm.isLightTheme ? \"Switch to dark theme\" : \"Switch to light theme\"},on:{\"click\":_vm.toggleTheme}},[_c('span',{staticClass:\"theme-icon\"},[_vm._v(_vm._s(_vm.isLightTheme ? '' : ''))])]),_c('div',{staticClass:\"sidebar\",class:{\"sidebar-open\": _vm.sidebarOpen}},[_c('div',{staticClass:\"editor-container\"},[_c('div',{staticClass:\"section\"},[_c('div',{staticClass:\"title\"},[_vm._v(\" L-Systems \"),_vm._m(0),_c('a',{staticClass:\"github-link\",attrs:{\"href\":\"https://github.com/ZanSara/L-systems\",\"target\":\"_blank\",\"title\":\"View source on GitHub\"}},[_c('svg',{attrs:{\"viewBox\":\"0 0 16 16\",\"width\":\"16\",\"height\":\"16\",\"fill\":\"currentColor\"}},[_c('path',{attrs:{\"d\":\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z\"}})])])]),(_vm.syntaxHelpVisible)?_c('div',{staticClass:\"help\"},[_vm._v(\" L-Systems are described very well on \"),_c('a',{attrs:{\"href\":\"http://paulbourke.net/fractals/lsys/\",\"target\":\"_blank\"}},[_vm._v(\"Paul Bourke's website\")]),_vm._v(\". \"),_vm._m(1)]):_vm._e(),_c('div',{staticClass:\"editor-wrapper\"},[_c('a',{staticClass:\"syntax-help-button\",class:{\"syntax-visible\": _vm.syntaxHelpVisible},attrs:{\"href\":\"#\",\"title\":\"click to learn more about syntax\"},on:{\"click\":function($event){$event.preventDefault();_vm.syntaxHelpVisible = !_vm.syntaxHelpVisible}}},[_vm._v(\"?\")]),(_vm.codeEditorModel)?_c('code-editor',{staticClass:\"code-editor-container\",attrs:{\"model\":_vm.codeEditorModel}}):_vm._e()],1),_c('div',{staticClass:\"view-controls\"},[_c('div',{staticClass:\"rotation-control\"},[_c('label',{attrs:{\"for\":\"line-width\"}},[_vm._v(\"Line Width:\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.lineWidth),expression:\"lineWidth\",modifiers:{\"number\":true}}],attrs:{\"id\":\"line-width\",\"type\":\"range\",\"min\":\"1\",\"max\":\"30\",\"step\":\"1\"},domProps:{\"value\":(_vm.lineWidth)},on:{\"input\":_vm.updateLineWidth,\"__r\":function($event){_vm.lineWidth=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{staticClass:\"rotation-value\"},[_vm._v(_vm._s(_vm.lineWidth)+\"px\")])]),_c('div',{staticClass:\"grid-toggle\"},[_c('label',{attrs:{\"for\":\"show-grid\"}},[_vm._v(\"Show Grid:\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.showGrid),expression:\"showGrid\"}],staticClass:\"grid-checkbox\",attrs:{\"id\":\"show-grid\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.showGrid)?_vm._i(_vm.showGrid,null)>-1:(_vm.showGrid)},on:{\"change\":[function($event){var $$a=_vm.showGrid,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.showGrid=$$a.concat([$$v]))}else{$$i>-1&&(_vm.showGrid=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.showGrid=$$c}},_vm.toggleGrid]}}),_c('span',{staticClass:\"toggle-switch\",class:{\"active\": _vm.showGrid},on:{\"click\":function($event){_vm.showGrid = !_vm.showGrid; _vm.toggleGrid()}}})]),_c('div',{staticClass:\"rotation-control\"},[_c('label',{attrs:{\"for\":\"rotation\"}},[_vm._v(\"Rotation:\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.rotation),expression:\"rotation\",modifiers:{\"number\":true}}],attrs:{\"id\":\"rotation\",\"type\":\"range\",\"min\":\"0\",\"max\":\"360\",\"step\":\"1\"},domProps:{\"value\":(_vm.rotation)},on:{\"input\":_vm.updateRotation,\"__r\":function($event){_vm.rotation=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{staticClass:\"rotation-value\"},[_vm._v(_vm._s(_vm.rotation)+\"\")])])]),_c('div',{staticClass:\"controls\"},[_c('a',{staticClass:\"album-button\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.pickFromAlbum.apply(null, arguments)}}},[_vm._v(\"Pick from Examples\")]),_c('a',{staticClass:\"randomize-button\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.trueRandomize.apply(null, arguments)}}},[_vm._v(\"Random Values\")]),_c('a',{staticClass:\"stop-button\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.stopGeneration.apply(null, arguments)}}},[_vm._v(\"Stop Generation\")]),_c('a',{staticClass:\"save-button\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toSVGFile.apply(null, arguments)}}},[_vm._v(\"Save as SVG\")])]),_c('div',{staticClass:\"section examples-section\"},[_c('div',{staticClass:\"title\"},[_vm._v(\"Examples\")]),_c('div',{staticClass:\"examples-list\"},_vm._l((_vm.examples),function(example,index){return _c('a',{key:index,staticClass:\"example-item\",class:{\"active\": _vm.currentExampleIndex === example.index},attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();return _vm.loadExample(example.index)}}},[_vm._v(\" \"+_vm._s(example.name)+\" \")])}),0)])])])]),(_vm.showSelectionMask)?_c('div',{staticClass:\"selection-overlay\"},[_c('div',{staticClass:\"selection-mask\",style:({\n          left: _vm.selectionRect.left + \"px\",\n          top: _vm.selectionRect.top + \"px\",\n          width: _vm.selectionRect.width + \"px\",\n          height: _vm.selectionRect.height + \"px\"\n        }),on:{\"mousedown\":_vm.startDrag}},[_c('div',{staticClass:\"selection-border\"}),_c('div',{staticClass:\"resize-handle nw\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"nw\", $event)}}}),_c('div',{staticClass:\"resize-handle ne\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"ne\", $event)}}}),_c('div',{staticClass:\"resize-handle sw\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"sw\", $event)}}}),_c('div',{staticClass:\"resize-handle se\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"se\", $event)}}}),_c('div',{staticClass:\"resize-handle n\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"n\", $event)}}}),_c('div',{staticClass:\"resize-handle s\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"s\", $event)}}}),_c('div',{staticClass:\"resize-handle w\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"w\", $event)}}}),_c('div',{staticClass:\"resize-handle e\",on:{\"mousedown\":function($event){$event.stopPropagation();return _vm.startResize(\"e\", $event)}}})]),_c('div',{staticClass:\"selection-controls\"},[_c('button',{staticClass:\"selection-confirm-btn\",on:{\"click\":_vm.confirmSelection}},[_vm._v(\" Confirm Selection \")]),_c('button',{staticClass:\"selection-cancel-btn\",on:{\"click\":_vm.cancelSelection}},[_vm._v(\" Cancel \")])])]):_vm._e(),(_vm.showSaveModal)?_c('div',{staticClass:\"modal-overlay\",on:{\"click\":function($event){_vm.showSaveModal = false}}},[_c('div',{staticClass:\"modal-content\",on:{\"click\":function($event){$event.stopPropagation();}}},[_c('h3',[_vm._v(\"Save as SVG\")]),_c('p',[_vm._v(\"Choose which theme version(s) to save:\")]),_c('div',{staticClass:\"modal-buttons\"},[_c('button',{staticClass:\"modal-btn light-btn\",on:{\"click\":function($event){return _vm.saveSVGVersion(\"light\")}}},[_vm._v(\"  Light Theme \"),_c('span',{staticClass:\"filename\"},[_vm._v(\"l-system-light.svg\")])]),_c('button',{staticClass:\"modal-btn dark-btn\",on:{\"click\":function($event){return _vm.saveSVGVersion(\"dark\")}}},[_vm._v(\"  Dark Theme \"),_c('span',{staticClass:\"filename\"},[_vm._v(\"l-system-dark.svg\")])]),_c('button',{staticClass:\"modal-btn both-btn\",on:{\"click\":function($event){return _vm.saveSVGVersion(\"both\")}}},[_vm._v(\"  Both Themes \"),_c('span',{staticClass:\"filename\"},[_vm._v(\"2 files\")])])]),_c('button',{staticClass:\"modal-cancel\",on:{\"click\":function($event){_vm.showSaveModal = false}}},[_vm._v(\"Cancel\")])])]):_vm._e()])\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('a',{attrs:{\"href\":\"https://zansara.dev\"}},[_c('small',[_vm._v(\" by Sara Zan \")])])\n},function (){var _vm=this,_c=_vm._self._c;return _c('p',[_vm._v(\"The following is the list of available sections: \"),_c('ul',[_c('li',[_c('strong',[_vm._v(\"axiom\")]),_vm._v(\": initial state of the system\")]),_c('li',[_c('strong',[_vm._v(\"rules\")]),_vm._v(\": list of rewrite rules that are applied on each iteration\")]),_c('li',[_c('strong',[_vm._v(\"depth\")]),_vm._v(\": how deep we are allowed to go recursively\")]),_c('li',[_c('strong',[_vm._v(\"angle\")]),_vm._v(\": if specified, this argument governs rotation angle. Can be overridden with \"),_c('strong',[_vm._v(\"actions\")])]),_c('li',[_c('strong',[_vm._v(\"actions\")]),_vm._v(\": list of graphic commands that are triggered by a matching character in the evolved system. The following is the list of available actions: \"),_c('ul',[_c('li',[_c('strong',[_vm._v(\"draw(x)\")]),_vm._v(\" draw \"),_c('code',[_vm._v(\"x\")]),_vm._v(\" units in current direction\")]),_c('li',[_c('strong',[_vm._v(\"move(x)\")]),_vm._v(\" move \"),_c('code',[_vm._v(\"x\")]),_vm._v(\" units in current direction without drawing\")]),_c('li',[_c('strong',[_vm._v(\"rotate(deg)\")]),_vm._v(\" rotate current direction \"),_c('code',[_vm._v(\"deg\")]),_vm._v(\" degrees around Z axis\")]),_c('li',[_c('strong',[_vm._v(\"rotateX(deg)\")]),_vm._v(\" rotate current direction \"),_c('code',[_vm._v(\"deg\")]),_vm._v(\" degrees around X axis\")]),_c('li',[_c('strong',[_vm._v(\"rotateY(deg)\")]),_vm._v(\" rotate current direction \"),_c('code',[_vm._v(\"deg\")]),_vm._v(\" degrees around Y axis\")]),_c('li',[_c('strong',[_vm._v(\"push()\")]),_vm._v(\" saves current render state onto stack\")]),_c('li',[_c('strong',[_vm._v(\"pop()\")]),_vm._v(\" restores previously saved render state\")]),_c('li',[_c('strong',[_vm._v(\"setColor(color)\")]),_vm._v(\" set the current color value, '#ffa500' or 'orange'.\")]),_c('li',[_c('strong',[_vm._v(\"swapAngle()\")]),_vm._v(\" swaps the meaning of `+` and `-`.\")])]),_c('p',[_vm._v(\"By default the following actions are added automatically:\")]),_c('pre',[_c('code',[_vm._v(\"actions:\\n  F => draw(10)\\n  f => move(10)\\n  + => rotate(60)\\n  - => rotate(-60)\\n  & => swapAngle()\\n  [ => push()\\n  ] => pop()\\n\")])])]),_c('li',[_c('strong',[_vm._v(\"width\")]),_vm._v(\": width in pixels of the drawn line\")]),_c('li',[_c('strong',[_vm._v(\"color\")]),_vm._v(\": color of the line. Accepts names and hex. E.g. \"),_c('code',[_vm._v(\"blue\")]),_vm._v(\", works the same as \"),_c('code',[_vm._v(\"#0000ff\")])]),_c('li',[_c('strong',[_vm._v(\"stepsPerFrame\")]),_vm._v(\": how many steps we are allowed to render per single frame. If set to \"),_c('code',[_vm._v(\"-1\")]),_vm._v(\" the scene is rendered immediately. This could be dangerous on deep systems, as the entire system traversal may exhaust the browser's resources. \")]),_c('li',[_c('strong',[_vm._v(\"direction\")]),_vm._v(\": three numbers separated by coma \"),_c('code',[_vm._v(\"x, y, z\")]),_vm._v(\" that set initial direction\")]),_c('li',[_c('strong',[_vm._v(\"position\")]),_vm._v(\": three numbers separated by coma \"),_c('code',[_vm._v(\"x, y, z\")]),_vm._v(\" that set initial position\")])])])\n}]\n\nexport { render, staticRenderFns }","import {GLCollection, defineProgram, InstancedAttribute, ColorAttribute} from 'w-gl';\n\nexport default class LineCollection extends GLCollection {\n  constructor(gl, options = {}) {\n    let program = defineProgram({\n      gl,\n      vertex: `\n    uniform mat4 modelViewProjection;\n    uniform float width;\n    uniform vec2 resolution;\n\n    attribute vec4 color;\n    attribute vec3 from, to;\n    attribute vec2 point;\n\n    varying vec4 vColor;\n    varying vec2 vPoint;\n\n    void main() {\n      vec4 clip0 = modelViewProjection * vec4(from, 1.0);\n      vec4 clip1 = modelViewProjection * vec4(to, 1.0);\n\n      vec2 screen0 = resolution * (0.5 * clip0.xy/clip0.w + 0.5);\n      vec2 screen1 = resolution * (0.5 * clip1.xy/clip1.w + 0.5);\n\n      vec2 xBasis = normalize(screen1 - screen0);\n      vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n\n      // Offset the original points:\n      vec2 pt0 = screen0 + width * point.x * yBasis;\n      vec2 pt1 = screen1 + width * point.x * yBasis;\n\n      vec2 pt = mix(pt0, pt1, point.y);\n      vec4 clip = mix(clip0, clip1, point.y);\n\n      gl_Position = vec4(clip.w * (2.0 * pt/resolution - 1.0), clip.z, clip.w);\n      vColor = color.abgr; // mix(.abgr, aToColor.abgr, aPosition.y);\n    }`,\n\n      fragment: `\n    precision highp float;\n    varying vec4 vColor;\n\n    void main() {\n      gl_FragColor = vColor;\n    }`,\n      attributes: {\n        color: new ColorAttribute()\n      },\n      instanced: {\n        point: new InstancedAttribute([\n          -0.5, 0, -0.5, 1, 0.5, 1, // First 2D triangle of the quad\n          -0.5, 0, 0.5, 1, 0.5, 0   // Second 2D triangle of the quad\n        ])\n      }\n    });\n    super(program);\n    this.width = options.width || 2;\n    this.multiColorSegment = true;\n  }\n\n  draw(_, drawContext) {\n    if (!this.uniforms) {\n      this.uniforms = {\n        modelViewProjection: this.modelViewProjection,\n        width: this.width,\n        resolution: [drawContext.width, drawContext.height]\n      }\n    }\n    this.uniforms.resolution[0] = drawContext.width;\n    this.uniforms.resolution[1] = drawContext.height;\n    this.program.draw(this.uniforms);\n  }\n\n  // implement lineRenderTrait to allow SVG export via w-gl\n  forEachLine(cb) {\n    let count = this.program.getCount()\n    for (let i = 0; i < count; ++i) {\n      let vertex = this.program.get(i);\n      let from = { x: vertex.from[0], y: vertex.from[1], z: vertex.from[2], color: vertex.color }\n      let to = { x: vertex.to[0], y: vertex.to[1], z: vertex.to[2], color: vertex.color }\n      cb(from, to);\n    }\n  }\n\n  getLineColor(from) {\n    let count = this.program.getCount()\n    let c = from ? \n              from.color :  \n              count > 0 ? this.program.get(0).color : 0xFFFFFFFF;\n\n    return [\n      ((c >> 24) & 0xFF) / 255,\n      ((c >> 16) & 0xFF) / 255,\n      ((c >>  8) & 0xFF) / 255,\n      ((c >>  0) & 0xFF) / 255,\n    ]\n  }\n}","import LineCollection from './LineCollection';\nimport tinycolor from 'tinycolor2';\n\nexport default class Turtle {\n  constructor(scene, options = {}) {\n    this.position = options.position || [0, 0, 0];\n    checkArray('position', this.position);\n    this.direction = options.direction || [1, 0, 0];\n    normalize(this.direction);\n    checkArray('direction', this.direction);\n\n    this.lines = new LineCollection(scene.getGL(), { capacity: 1024, width: options.width || 2 });\n    this.scene = scene;\n    this.color = options.color || 0xFFFFFFFF;\n\n    this.scene.appendChild(this.lines);\n    this.stack = [];\n    this.invertZYAngle = false;\n  }\n\n  push() {\n    this.stack.push({\n      color: this.color,\n      direction: [this.direction[0], this.direction[1], this.direction[2]],\n      position: [this.position[0], this.position[1], this.position[2]],\n    })\n  }\n\n  pop() {\n    let state = this.stack.pop();\n    this.color = state.color;\n    this.direction = state.direction;\n    this.position = state.position;\n  }\n\n  dispose() {\n    this.scene.removeChild(this.lines);\n  }\n\n  move(distance) {\n    let p = this.position;\n    let n = this.direction;\n    let x = p[0] + distance * n[0];\n    let y = p[1] + distance * n[1];\n    let z = p[2] + distance * n[2];\n    p[0] = x; p[1] = y; p[2] = z;\n  }\n\n  draw(distance) {\n    let p = this.position;\n    let n = this.direction;\n    let x = p[0] + distance * n[0];\n    let y = p[1] + distance * n[1];\n    let z = p[2] + distance * n[2];\n    this.lines.add({\n      from: p, \n      to: [x, y, z],\n      color: this.color\n    });\n\n    p[0] = x; p[1] = y; p[2] = z;\n    this.scene.renderFrame();\n  }\n\n  setColor(newColorValue) {\n    if (newColorValue === undefined) {\n      throw new Error('setColor() expects color value, got undefined');\n    }\n    const rgba = tinycolor(typeof newColorValue === 'number' ? \n      Object.values(tinycolor.names)[newColorValue] : newColorValue\n    ).toRgb();\n    this.color = (rgba.r << 24) | (rgba.g << 16) | (rgba.b << 8) | (rgba.a * 255 | 0)\n  }\n\n  rotateZ(angleInDegrees) {\n    if (this.invertZYAngle) angleInDegrees *= -1;\n    let rad = Math.PI * angleInDegrees / 180;\n    let n = this.direction;\n\n    let x = Math.cos(rad) * n[0] - Math.sin(rad) * n[1];\n    let y = Math.sin(rad) * n[0] + Math.cos(rad) * n[1];\n\n    n[0] = x;\n    n[1] = y;\n  }\n\n  rotateY(angleInDegrees) {\n    if (this.invertZYAngle) angleInDegrees *= -1;\n    let rad = Math.PI * angleInDegrees / 180;\n    let n = this.direction;\n\n    let x = Math.cos(rad) * n[0] - Math.sin(rad) * n[2];\n    let z = Math.sin(rad) * n[0] + Math.cos(rad) * n[2];\n\n    n[0] = x;\n    n[2] = z;\n  }\n\n  rotateX(angleInDegrees) {\n    let rad = Math.PI * angleInDegrees / 180;\n    let n = this.direction;\n\n    let y = Math.cos(rad) * n[1] - Math.sin(rad) * n[2];\n    let z = Math.sin(rad) * n[1] + Math.cos(rad) * n[2];\n\n    n[1] = y;\n    n[2]= z;\n  }\n\n  swapAngle() {\n    this.invertZYAngle = !this.invertZYAngle;\n  }\n}\n\nfunction checkArray(arrayName, array, ) {\n  if (!Array.isArray(array)) {\n    throw new Error('Array is expected for `' + arrayName + '`');\n  }\n  if (array.length === 2) {\n    array.push(0);\n  }\n  if (array.length !== 3) {\n    throw new Error('Array `' + arrayName + '` should have 2 or 3 coordinates, got ' + array.length);\n  }\n}\nfunction normalize(arr) {\n  let l = Math.hypot(arr[0], arr[1], arr[2]);\n  arr[0] /= l;\n  arr[1] /= l;\n  arr[2] /= l;\n}\n","import Turtle from './Turtle';\nimport tinycolor from 'tinycolor2';\n\n// We don't want to crash the browser. If the expanded system is larger than this\n// we will stop iteration\nconst LIMIT = 1000000;\n\nexport default class LSystem {\n  constructor(scene, systemSettings) {\n    coerceTypes(systemSettings);\n    this.rules = systemSettings.rules;\n    this.actions = compileActions(systemSettings, this);\n    this.turtle = new Turtle(scene, systemSettings);\n    this.stepsPerFrame = systemSettings.stepsPerFrame || 42;\n    this.drawQueue = [];\n    this.lastDrawnIndex = -1;\n\n    const depth = Number.isFinite(systemSettings.depth) ? systemSettings.depth : 5;\n    let start = systemSettings.start;\n    if (start === undefined) start = Object.keys(this.rules)[0];\n    if (start === undefined) throw new Error('System does not have neither rewrite rules nor start state');\n    this.start = start;\n    this.depth = depth;\n    this.simulate(); // TODO: Might exhaust system resources\n    this.iterator = this.renderIterator();\n  }\n\n  dispose() {\n    this.turtle.dispose();\n  }\n\n  frame() {\n    let next, steps = 0;\n    do {\n      next = this.iterator.next();\n    } while (!next.done && steps++ < this.stepsPerFrame );\n    return !next.done;\n  }\n\n  simulate() {\n    let production = this.start;\n    let index = 0;\n    while (index < this.depth && production.length < LIMIT) {\n      production = this.iterateRules(production);\n      index += 1;\n    }\n\n    this.production = production;\n    this.complete = production.length < LIMIT;\n  }\n\n  iterateRules(rule) {\n    let result = [];\n    for (let op of rule) {\n      let rewriteRule = this.rules[op];\n      if (rewriteRule !== undefined) result.push(rewriteRule);\n      else result.push(op);\n    }\n    return result.join('');\n  }\n\n  *renderIterator() {\n    for (let op of this.production) {\n      if (this.actions[op]) {\n        if (this.stepsPerFrame < 0) {\n          yield* this.actions[op]();\n        } else {\n          yield this.actions[op]();\n        }\n      }\n    }\n  }\n}\n\nfunction compileActions(systemSettings, lSystem) {\n  let actions = {};\n\n  let defaultRotationAngle = Number.isFinite(systemSettings.angle) ? systemSettings.angle : 60; \n\n  let mergedActions = {\n    'F': {name: 'draw', args: []},\n    'f': {name: 'move', args: []},\n    '+': {name: 'rotate', args: [defaultRotationAngle]},\n    '-': {name: 'rotate', args: [-defaultRotationAngle]},\n    '&': {name: 'swapAngle', args: [-defaultRotationAngle]},\n    '[': {name: 'push', args: []},\n    ']': {name: 'pop', args: []},\n    ...systemSettings.actions\n  }\n\n  Object.keys(mergedActions).forEach(key => {\n    let value = mergedActions[key];\n    let turtleAction = turtleCanDo(value, lSystem);\n    if (turtleAction) {\n      actions[key] = turtleAction;\n    } else {\n      throw new Error(\"Turtle does not know how to do '\" + value + \"'\");\n    }\n  });\n\n  return actions;\n}\n\nfunction turtleCanDo(command, lSystem) {\n  if (command.name.indexOf('rotate') === 0) {\n    let angle = command.args[0]\n    if (!Number.isFinite(angle)) throw new Error('`rotate() needs one float argument');\n\n    switch (command.name) {\n      case 'rotateX': return function() { lSystem.turtle.rotateX(angle) };\n      case 'rotateY': return function() { lSystem.turtle.rotateY(angle) };\n    }\n\n    return function() { lSystem.turtle.rotateZ(angle) };\n  }\n\n  if (command.name === 'draw') {\n    let length = getLength(command.args[0], 'draw');\n    return function() {\n      lSystem.turtle.draw(length)\n    }\n  }\n\n  if (command.name.match(/chcolor|setColor/i)) {\n    let color = command.args[0];\n    return function() {\n      lSystem.turtle.setColor(color)\n    }\n  }\n\n  if (command.name === 'push') return function() {lSystem.turtle.push()}\n  if (command.name === 'pop') return function() {lSystem.turtle.pop()}\n  if (command.name === 'move') {\n    let length = getLength(command.args[0], 'move');\n    return function() {lSystem.turtle.move(length)}\n  }\n  if (command.name.match(/swapAngle/i)) {\n    return function() {lSystem.turtle.swapAngle()}\n  }\n}\n\n\nfunction getLength(value, name) {\n  let length = 10;\n  if (value !== undefined) {\n    length = value;\n     if (!Number.isFinite(length)) throw new Error(name  +'(l) expects `l` to be a float number. Got: ' + value);\n  }\n  return length;\n}\n\n\nfunction coerceTypes(system) {\n  if (system.angle !== undefined) system.angle = Number.parseFloat(system.angle);\n  if (system.width !== undefined) system.width = Number.parseFloat(system.width);\n  if (system.depth !== undefined) system.depth = Number.parseFloat(system.depth);\n  if (system.color !== undefined) {\n    // If color is already a number, it's in RRGGBBAA format - don't convert it\n    if (typeof system.color !== 'number') {\n      let rgba = tinycolor(system.color).toRgb();\n      system.color = (rgba.r << 24) | (rgba.g << 16) | (rgba.b << 8) | (rgba.a * 255 | 0)\n    }\n  }\n}\n","import {createScene, createGuide, toSVG} from 'w-gl';\nimport LSystem from './LSystem';\n\nexport default function createLScene(canvas) {\n  let scene = createScene(canvas, {\n    // Disable 3D transformations, only allow 2D panning and zooming\n    camera: {\n      allowRotation: false,\n      allowPinchRotation: false\n    }\n  });\n  let guide = null; // Start with grid hidden\n\n  scene.setClearColor(0, 0, 0, 1)\n  let initialSceneSize = 40;\n  let currentViewBox = {\n    left:  -initialSceneSize,\n    top:   -initialSceneSize,\n    right:  initialSceneSize,\n    bottom: initialSceneSize,\n  };\n  scene.setViewBox(currentViewBox);\n\n  let canDrawMore = false;\n  let lSystem = [];\n  let disposeLater;\n  let raf = requestAnimationFrame(frame);\n  let defaultColor = 0xFFFFFFFF; // white\n  let defaultLineWidth = 8;\n  let currentTheme = 'dark'; // Track current theme\n  let gridColor = 0x444444ff; // medium gray for dark theme\n\n  return {\n    dispose,\n    setSystem,\n    saveToSVG,\n    isComplete,\n    stop,\n    setTheme,\n    setLineWidth,\n    setGridVisible,\n    getScene: () => scene,\n  }\n\n  function saveToSVG(fileName, customViewBox) {\n    // Save the current viewBox if we're using a custom one\n    let originalViewBox = null;\n    if (customViewBox) {\n      originalViewBox = { ...currentViewBox };\n      currentViewBox = customViewBox;\n      scene.setViewBox(customViewBox);\n      scene.renderFrame(); // Force a render with the new viewBox\n    }\n\n    let svgOptions = {\n      open() {\n        return `<!-- Generator: https://zansara.dev/L-system -->`;\n      },\n      scale: 5\n    };\n\n    let svg = toSVG(scene, svgOptions);\n\n    // Restore the original viewBox if we changed it\n    if (originalViewBox) {\n      currentViewBox = originalViewBox;\n      scene.setViewBox(originalViewBox);\n      scene.renderFrame();\n    }\n\n    // Add non-scaling-stroke and line join/cap attributes for sharp corners\n    // Use square caps to extend lines at endpoints, ensuring they overlap and connect\n    svg = svg.replace(/<path /g, '<path vector-effect=\"non-scaling-stroke\" stroke-linejoin=\"miter\" stroke-linecap=\"square\" ');\n\n    let blob = new Blob([svg], {type: \"image/svg+xml\"});\n    let url = window.URL.createObjectURL(blob);\n    // For some reason, safari doesn't like when download happens on the same\n    // event loop cycle. Pushing it to the next one.\n    setTimeout(() => {\n      let a = document.createElement(\"a\");\n      a.href = url;\n      a.download = fileName;\n      a.click();\n      revokeLater(url);\n    }, 30)\n  }\n\n  function revokeLater(url) {\n    // In iOS immediately revoked URLs cause \"WebKitBlobResource error 1.\" error\n    // Setting a timeout to revoke URL in the future fixes the error:\n    setTimeout(() => {\n      window.URL.revokeObjectURL(url);\n    }, 45000);\n  }\n\n  function setSystem(newSystem) {\n    cancelAnimationFrame(raf);\n    if (disposeLater) {\n      lSystem.forEach(l => disposeLater.push(l));\n    } else {\n      disposeLater = lSystem;\n    }\n\n    if (!Array.isArray(newSystem)) {\n      newSystem = [newSystem]\n    }\n    lSystem = [];\n    newSystem.forEach(systemSettings => {\n      // Set default color if not specified\n      if (systemSettings.color === undefined) {\n        systemSettings.color = defaultColor;\n      }\n      // Set default line width if not specified\n      if (systemSettings.width === undefined) {\n        systemSettings.width = defaultLineWidth;\n      }\n      lSystem.push(new LSystem(scene, systemSettings));\n    });\n\n    raf = requestAnimationFrame(frame);\n  }\n\n  function isComplete() {\n    return lSystem.every(x => x.complete);\n  }\n\n  function frame() {\n    canDrawMore = false;\n    lSystem.forEach(drawSystem);\n    if (canDrawMore) {\n      raf = requestAnimationFrame(frame);\n    }\n    if (disposeLater) {\n      disposeLater.forEach(l => l.dispose())\n      disposeLater = null;\n    }\n  }\n\n  function drawSystem(system) {\n    canDrawMore |= system.frame();\n  }\n\n  function stop() {\n    cancelAnimationFrame(raf);\n    canDrawMore = false;\n  }\n\n  function setTheme(isLight) {\n    currentTheme = isLight ? 'light' : 'dark';\n\n    if (isLight) {\n      // Light theme: white background, black lines, dark gray grid\n      scene.setClearColor(1, 1, 1, 1);\n      defaultColor = 0x000000FF; // black: RRGGBBAA format\n      gridColor = 0x888888ff; // dark gray for light theme\n    } else {\n      // Dark theme: black background, white lines, light gray grid\n      scene.setClearColor(0, 0, 0, 1);\n      defaultColor = 0xFFFFFFFF; // white: RRGGBBAA format\n      gridColor = 0x444444ff; // medium gray for dark theme\n    }\n\n    // Update grid color if it's visible\n    if (guide) {\n      guide.dispose();\n      guide = createGuide(scene, {\n        lineColor: gridColor,\n        showCursor: false\n      });\n    }\n\n    // Force a re-render\n    scene.renderFrame();\n  }\n\n  function setLineWidth(width) {\n    defaultLineWidth = width;\n  }\n\n  function setGridVisible(visible) {\n    if (visible && !guide) {\n      guide = createGuide(scene, {\n        lineColor: gridColor,\n        showCursor: false\n      });\n    } else if (!visible && guide) {\n      guide.dispose();\n      guide = null;\n    }\n    scene.renderFrame();\n  }\n\n  function dispose() {\n    cancelAnimationFrame(raf);\n    scene.dispose();\n  }\n}","/**\n * This is a very simple parser to parse our \"L-system\" language\n * \n * It works as a simple state machine, which has two rules:\n * \n * \"ExpectKeyValue\" and \"ExpectRewriteValue\". In each state it consumes\n * a line from the input and either transitions to the next state\n * or adds new key/values to the current state.\n */\nconst separator = /:|->|=>|=|/\nconst rules = /rules|production rules/i;\nconst actions = /actions/i;\nconst ws = /[ \\t]/g;\nconst numericKey = /angle|depth|width|stepsPerFrame/i;\nconst vectorKey = /direction|position/i;\nconst parens = /[[\\]()]/;\n\n/**\n * Read rewrite rule.\n */\nclass ExpectRewriteValue {\n  constructor(addTo, parent, valueParser) {\n    this.parent = parent;\n    this.addTo = addTo;\n    this.valueParser = valueParser || (result => result);\n  }\n\n  process(line) {\n    let result = line.split(separator)\n    if (result.length === 1) throw new Error('Expected `_ => value`, found ' + line);\n\n    let key = result[0].trim();\n    if (key.length !== 1) {\n      // we are done with this rule\n      return this.parent.process(line);\n    }\n    let v = result.slice(1).join('').replace(ws, '');\n    this.addTo[key] = this.valueParser(v);\n    return this;\n  }\n}\n\nfunction extractAction(stringValue) {\n  let m = stringValue.match(/(\\w+?)\\s*\\((.+?)?\\)/);\n  if (!m) {\n    throw new Error('Expected `action()` call, got: ' + stringValue);\n  }\n  let name = m[1];\n  let args;\n  if (!m[2]) args = []; \n  else {\n    args = m[2].split(',').map(v => {\n      let stringValue = extractStringValue(v);\n      if (stringValue !== undefined) return stringValue;\n      return Number.parseFloat(v.trim());\n    });\n  }\n  return {name, args};\n}\n\nfunction extractStringValue(value) {\n  let matchedString = (value && value.match(/\\s*(?:'(.*?)'|\"(.*?)\")\\s*/));\n  if (matchedString) {\n    return matchedString[1] || matchedString[2];\n  }\n}\n\n/**\n * Expect arbitrary key/value line.\n */\nclass ExpectKeyValue {\n  constructor(addTo) {\n    this.addTo = addTo;\n  }\n\n  process(line) {\n    let result = line.split(separator)\n    if (result.length === 1) throw new Error('Expected `key: value`, found ' + line);\n    let key = result[0].trim();\n    let value = result.slice(1).join('').trim();\n    if (key.match(rules)) {\n      this.addTo.rules = {};\n      return new ExpectRewriteValue(this.addTo.rules, this);\n    } else if (key.match(actions)) {\n      this.addTo.actions = {};\n      return new ExpectRewriteValue(this.addTo.actions, this, extractAction);\n    } else if (key.match(numericKey)) {\n      let v = Number.parseFloat(value);\n      if (!Number.isFinite(v)) {\n        throw new Error('Expected a number value for `' + key + '`');\n      }\n      this.addTo[key] = v;\n      return this;\n    } else if (key.match(vectorKey)) {\n      this.addTo[key] = parseVector(value, key)\n      return this;\n    }\n\n    this.addTo[key] = value;\n    return this;\n  }\n}\n\nfunction parseVector(v, vectorName) {\n  return v.replace(parens, '').replace(ws, '').split(',').map((component, position) => {\n    if (!component) {\n      throw new Error('Missing vector component at position ' + position +' for `' + vectorName + '`');\n    }\n    let x = Number.parseFloat(component);\n    if (!Number.isFinite(x)) {\n      throw new Error('Vectors are expected to be numbers. Found `' + component + '` in `' + v + '`');\n    }\n    return x;\n  })\n}\n\nexport default function parse(str) {\n  let lines = str.split('\\n');\n  let currentState = new ExpectKeyValue({});\n\n  lines.forEach((line, lineNumber) => {\n    line = line.trim();\n    // ignore comments and empty lines\n    if (line === '' || line.startsWith('//')) return;\n    try {\n      currentState = currentState.process(line);\n    } catch (e) {\n      throw new Error(e.message + '\\n\\n at line ' + lineNumber);\n    }\n  });\n\n  while (currentState.parent) {\n    currentState = currentState.parent;\n  }\n  return currentState.addTo;\n}\n","import parseExpression from './grammar/parser';\nconst queryState = require('query-state');\n\nvar qs = queryState({\n  code: getInitialCode()\n}, {\n  useSearch: true\n});\n\n// Create a Parser object from our grammar.\nlet standardCollection = [\n`// Dragon\naxiom: X\nrules: \n X => X+YF+\n Y => -FX-Y\n\ndepth: 10\nangle: 90`,\n\n`// William McWorters: Terdragon\naxiom: F\nrules: \n F => F+F-F\n\ndepth: 8\nangle: 120`,\n\n`// William McWorters: Pentl\naxiom: F-F-F-F-F\nrules: \n  F => cF-F-F++dF+F-F \n\ndepth: 4\nangle: 72\nactions:\n  c => setColor(\"mediumpurple\")\n  d => setColor(\"violet\") `,\n\n`// William McWorters: Pentant\naxiom: X-X-X-X-X\nrules: \n  F => \n  X => dFX-FX-FX+FY+FY+FX-FX\n  Y => cFY+FY-FX-FX-FY+FY+FY\n\ndepth: 3\nangle: 72\nactions:\n  c => setColor(\"goldenrod\")\n  d => setColor(\"gold\") `,\n\n`// William McWorter: Siernski Carpet \naxiom: F\nrules: \n F => cF+F-F-F-f+dF+F+F-F\n f => fff\n\nangle: 90\ndepth: 4\nactions:\n  c => setColor(\"goldenrod\")\n  d => setColor(\"gold\") `,\n\n`// Hexagonal Gosper\naxiom: X\nrules:\n X => X+YF++YF-FX--FXFX-YF+\n Y => -FX+YFYF++YF+FX--FX-Y \n\nangle: 60`,\n\n`// Peano curve\naxiom: X\nrules: \n X => XFYFX-F-YFXFY+F+XFYFX\n Y => YFXFY+F+XFYFX-F-YFXFY\n\ndepth:4\nangle: 90`,\n\n`// Gary Teachout: Pean-c\naxiom: FX\nrules:\n F => \n X =>  FX-FY-FX+FY+FX+FY+FX+FY+FX-FY-FX-FY-FX-FY-FX+FY+FX\n Y => FY\n\ndepth: 3\nangle: 45`,\n\n`// Square Sierpinski\naxiom: F+XF+F+XF\nrules: \n X => XF-F+F-XF+F+XF-F+F-X\n\ndepth: 4\nangle: 90 `,\n\n`// Tree\naxiom: X\nrules: \n F => FF\n X => F-[[X]+X]+F[+FX]-X\n\ndirection: [0, 1, 0]\nangle: 22.5`,\n`// Tree (color)\naxiom: X\nrules: \n F => FF\n X => F-[[X]+X]+cF[+dFX]-X\n\ncolor:brown\ndirection: [0, 1, 0]\nangle: 22.5a\nactions:\n  c => setColor('green')\n  d => setColor('lightgreen')`,\n\n`// P. Bourke: Bush\naxiom: Y\nrules: \n  X => X[-FFF]c[+FFF]FX\n  Y => dYFXe[+Y][-Y]\n\ncolor: brown\ndirection: [0, 1, 0]\nangle: 22.5\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('brown')`,\n\n` // P. Bourke: Grains\naxiom: Y\nrules: \n  X => dX[-F+FF]cg[+F-FF]dFX\n  Y => eYFX[+Y][-Y]\n\ndepth:5\ndirection: [0, 1, 0]\nangle: 27\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('lightgreen')\n  g => rotate(0.3)`,\n\n` // P. Bourke: Grains 2\naxiom: Y\nrules: \n  X => cX[-FF-F]g[+FF+F]dFX\n  Y => eYFX[+Y][-Y]XFY\n\ndepth:4\ndirection: [0, 1, 0]\nangle: 27\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('gold')\n  g => rotate(0.2)`,\n\n`// P. Bourke: Bush\naxiom: F\nrules: \n  F => FF+[c+F-F-F]-[-F+F+dF]\n\ncolor: green\ndirection: [0, 1, 0]\nangle: 21\ndepth:4\nactions:\n  c => setColor('green')\n  d => setColor('lime')`,\n\n`// P. Bourke: Pentaplexy\naxiom: F++F++F++F++F\nrules: \n  F => cF++F++F+++++dF-F++F\n\ndepth:3\nangle: 36\nactions:\n  c => setColor('mediumpurple')\n  d => setColor('violet')`,\n\n`// Poetasters Shrub\naxiom: F\nrules: \n F => Fe[+cFF]Fd[-FF]cF\n\ncolor:brown\ndirection: [0, 1, 0]\nangle: 322\ndepth: 4\nactions:\n  c => setColor('green')\n  d => setColor('lightgreen')\n  e => setColor('brown')`,\n\n`// Poetasters Weed\naxiom: F\nrules:\n  F -> F-[XY]+[XY]F+[XY]-[XY]\n  X -> +dFY\n  Y -> -cFX\n\ncolor: brown\ndirection: [0, 1, 0.5]\nangle: 22.5\ndepth:5\nactions:\n  c => setColor('green')\n  d => setColor('lime')`,\n\n`// Unlikely Bush\naxiom: F\nrules: \n  F => eF[+cFF][-FF]cF[-F]d[+F]F\n\ncolor: brown\ndirection: [0, 1, 0]\nangle: 330\ndepth:3\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('brown')`,\n\n`// Weed\naxiom: F\nrules:\n  F -> FF-[XY]+[XY]\n  X -> +cFY\n  Y -> -dFX\n\ncolor: brown\ndirection: [0, 1, 1]\nangle: 22.5\nactions:\n  c => setColor('green')\n  d => setColor('lime')`,\n\n`// Saupe\naxiom: VZFFF\nrules:\n  V -> [+++W][---W]YV\n  W -> +X[-W]Z\n  X -> -W[+X]Z\n  Y -> YZ\n  Z -> [-FcFF][+FdFF]F\n\ncolor: green\ndepth:8\ndirection: [0, 1, 0]\nangle: 20\nactions:\n  c => setColor('lightgreen')\n  d => setColor('lime')`,\n\n`// Poetaster's curly\naxiom: F+F-F+F\nrules: \n  F => eF-F-F++[cF+F-dF[GGG]][GGG]\n  G => c--g--g--g--g--g--g--g\n\ndepth: 3\nangle: 17\nwidth:2\ndirection: [-0.5,0.7,-0.5]\nactions:\n  c => setColor(\"palegreen\")\n  d => setColor(\"violet\") \n  e => setColor(\"green\")\n  g => draw(2)`,\n\n`// Aquatic Plant\naxiom: F\nrules:\n  F -> FFc[-F++F]d[+F--F]e++F--F\n\ncolor: brown\ndirection: [0, 1, 0.5]\nangle: 27\ndepth:4\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('goldenrod')`,\n\n`// Aquatic Plant 2\naxiom: F\nrules:\n  F => FMNOMBxPNMyO\n  M => e[-F++F++]\n  N => d[+F--F--]\n  O => c++F--F\n  P => d--F++F\n\ncolor: brown\ndirection: [0, 1, -1]\nangle: 27\ndepth:5\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('goldenrod')\n  x => rotateX(2)\n  y => rotateY(-3)`,\n\n`// Poetasters Aquatic Plant\naxiom: F\nrules:\n  F -> FMNxQRyQR[O-O-O-O-0]\n  M => d[++FF+FF+]\n  N => d[--FF-FF-]\n  O => e[F-F-F++dF+F-F]\n  Q => c++F--F\n  R => c--F++F\n\ncolor: brown\ndirection: [0, 1, -1]\nangle: 17\ndepth:4\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('goldenrod')\n  x => rotateX(2)\n  y => rotateY(-1.5)`,\n\n`// Poetasters Sallow Thorn\naxiom: F\nrules:\n  F -> FMNxQRyQROP\n  M => d[++FF+FF+]\n  N => d[--FF-FF-]\n  O => e[-F++F++]\n  P => e[+F--F--]\n  Q => c++F--F\n  R => c--F++F\n\ncolor: brown\ndirection: [0.5, 1, -1]\nangle: 27\ndepth:5\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('goldenrod')\n  x => rotateX(2)\n  y => rotateY(-1.5)`,\n\n`// Pean-c Flower\naxiom: FXhFXiFX\nrules:\n F => \n X =>  [FX-FY][-cFX-FY-FX][ZZ]-dFY-FX+FY+FX\n Y => FY\n Z => -cFX-FY-FX\n\ncolor: green\ndepth: 3\nangle: 340\nwidth: 2\ndirection: [1,1,1]\nactions:\n  c => setColor(\"violet\")\n  d => setColor(\"lime\")\n  h => rotate(5)\n  i => rotate(-3)`,\n\n`// Poetasters Succulent 1\naxiom: A\nrules:\n A =>[FL]gAhg[FLA]\n F => cSF \n S => dFL\n L => c[F+F+F]fe[F-F-F]\n\ncolor:green\ndirection: [0, 1, 0.5]\nwidth: 4\nangle: 17\ndepth: 7\nactions:\n  c => setColor('green')\n  d => setColor('lime')\n  e => setColor('lightgreen')\n  g => rotate(4.5)\n  h => rotate(-3)`,\n\n`// Pyramids\naxiom: F++F++F+++F--F--F\nrules: \n  F =>  cFF++F++F++dFFF\n\ncolor: gold\nangle: 60\ndepth:3\nactions:\n  c => setColor('gold')\n  d => setColor('goldenrod')`,\n\n`// Hilbert Curve\naxiom: X\nrules: \n X => -YF+XFX+FY-\n Y => +XF-YFY-FX+\n\nangle: 90`,\n\n`// Levey Curve\naxiom: F++F++F++F\nrules: \n  F => -dF++cF-\nangle: 45\ndepth: 12\nactions:\n  c => setColor(\"goldenrod\")\n  d => setColor(\"gold\")`,\n\n`// Blocks\naxiom: F+F+F+F\nrules: \n F => F-f+FF-FF-FF-FFf-FFFF\n f => ffffff\n\nangle: 90\ndepth: 3 `,\n\n`// Aztec Blocks\naxiom: F-F-F-F\nrules: \n F => F-cf+FF-F-FF-Ff-FF+df-FF+F+FF+Ff+FFF\n f => ffffff\n\nangle: 90\ndepth: 2\nactions:\n  c => setColor(\"goldenrod\")\n  d => setColor(\"gold\")`,\n\n`// Color Mosaic\naxiom: F+F+F+F\nrules: \n  F => dFF+F+cF+F+FF\n\ncolor: green\ndepth: 3\nangle: 90\nactions:\n  c => setColor('lime')\n  d => setColor('green')`,\n\n`// 3 Blocks\naxiom: F^^F^^F\nrules: \n F => F-fff^F^^F^^F&&fff-FFF\n f => fff\n\ndepth: 3\nactions:\n - => rotate(-90)\n ^ => rotate(60)\n & => rotate(-60) `,\n`// Leaf\naxiom: Y---Y\nrules: \n X => F-FF-F--[--X]F-FF-F--F-FF-F--\n Y => f-F+X+F-fY\n\ndepth: 8\nangle: 60`, `// Esum\naxiom: X+X+X+X+X+X+X+X\nrules: \n X => [F[-X++Y]]\n Y => [F[-Y--X]]\n F => F\n\ndepth: 6\nangle: -45`,\n`// Penrose tiling\naxiom: [N]++[N]++[N]++[N]++[N]\nrules: \n  M => OF++PF----NF[-OF----MF]++\n  N => +OF--PF[---MF--NF]+\n  O => -MF++NF[+++OF++PF]-\n  P => --OF++++MF[+PF++++NF]--NF\n  F => \n\ndepth: 4\nangle: 36\n`,\n`// L-System Leaf\naxiom: a\nrules: \n F => >F<\n a => F[+x]Fb\n b => F[-y]Fa\n x => a\n y => b\n\ndepth: 4\nangle: 45`,\n\n`// L-System Bushes 1\naxiom: Y\nrules: \n X => X[-FFF][+FFF]FX\n Y => YFX[+Y][-Y]\n\ndepth: 4\nangle: 25.7`,\n\n`// L-System Bushes 2\naxiom: F\nrules: \n F => FF+[+F-F-F]-[-F+F+F]\n\ndepth: 4\nangle: 22.5`,\n\n`// L-System Bushes 3\naxiom: F\nrules: \n F => F[+FF][-FF]F[-F][+F]F\n\ndepth: 4\nangle: 35`,\n\n`// L-System Bushes (Saupe)\naxiom: VZFFF\nrules: \n V => [+++W][---W]YV\n W => +X[-W]Z\n X => -W[+X]Z\n Y => YZ\n Z => [-FFF][+FFF]F\n\ndepth: 4\nangle: 20`,\n\n`// L-System Bushes (angle-scaled)\naxiom: FX\nrules: \n X => >[-FX]+FX\n\ndepth: 4\nangle: 40`,\n\n`// L-System Sticks\naxiom: X\nrules: \n F => FF\n X => F[+X]F[-X]+X\n\ndepth: 4\nangle: 20`,\n\n`// L-System Algae 1\naxiom: aF\nrules: \n a => FFFFFv[+++h][---q]fb\n b => FFFFFv[+++h][---q]fc\n c => FFFFFv[+++fa]fd\n d => FFFFFv[+++h][---q]fe\n e => FFFFFv[+++h][---q]fg\n g => FFFFFv[---fa]fa\n h => ifFF\n i => fFFF[--m]j\n j => fFFF[--n]k\n k => fFFF[--o]l\n l => fFFF[--p]\n m => fFn\n n => fFo\n o => fFp\n p => fF\n q => rfF\n r => fFFF[++m]s\n s => fFFF[++n]t\n t => fFFF[++o]u\n u => fFFF[++p]\n v => Fv\n\ndepth: 4\nangle: 12`,\n\n`// L-System Algae 2\naxiom: aF\nrules: \n a => FFFFFy[++++n][----t]fb\n b => +FFFFFy[++++n][----t]fc\n c => FFFFFy[++++n][----t]fd\n d => -FFFFFy[++++n][----t]fe\n e => FFFFFy[++++n][----t]fg\n g => FFFFFy[+++fa]fh\n h => FFFFFy[++++n][----t]fi\n i => +FFFFFy[++++n][----t]fj\n j => FFFFFy[++++n][----t]fk\n k => -FFFFFy[++++n][----t]fl\n l => FFFFFy[++++n][----t]fm\n m => FFFFFy[---fa]fa\n n => ofFFF\n o => fFFFp\n p => fFFF[-s]q\n q => fFFF[-s]r\n r => fFFF[-s]\n s => fFfF\n t => ufFFF\n u => fFFFv\n v => fFFF[+s]w\n w => fFFF[+s]x\n x => fFFF[+s]\n y => Fy\n\ndepth: 4\nangle: 12`,\n\n`// L-System Weed\naxiom: F\nrules: \n F => FF-[XY]+[XY]\n X => +FY\n Y => -FX\n\ndepth: 4\nangle: 22.5`,\n\n`// Triangle\naxiom: F+F+F\nrules: \n F => F-F+F\n\ndepth: 4\nangle: 120`,\n\n`// Quadratic Gosper\naxiom: -YF\nrules: \n X => XFX-YF-YF+FX+FX-YF-YFFX+YF+FXFXYF-FX+YF+FXFX+YF-FXYF-YF-FX+FX+YFYF-\n Y => +FXFX-YF-YF+FX+FXYF+FX-YFYF-FX-YF+FXYFYF-FX-YFFX+FX+YF-YF-FX+FX+YFY\n\ndepth: 4\nangle: 90`,\n\n`// Square Sierpinski\naxiom: F+XF+F+XF\nrules: \n X => XF-F+F-XF+F+XF-F+F-X\n\ndepth: 4\nangle: 90`,\n\n`// Crystal\naxiom: F+F+F+F\nrules: \n F => FF+F++F+F\n\ndepth: 4\nangle: 90`,\n\n`// Peano Curve\naxiom: X\nrules: \n X => XFYFX+F+YFXFY-F-XFYFX\n Y => YFXFY-F-XFYFX+F+YFXFY\n\ndepth: 4\nangle: 90`,\n\n`// Quadratic Snowflake\naxiom: F\nrules: \n F => F-F+F+F-F\n\ndepth: 4\nangle: 90`,\n\n`// Quadratic Snowflake\naxiom: FF+FF+FF+FF\nrules: \n F => F+F-F-F+F\n\ndepth: 4\nangle: 90`,\n\n`// Quadratic Koch Island 1\naxiom: F+F+F+F\nrules: \n F => F+F-F-FFF+F+F-F\n\ndepth: 4\nangle: 90`,\n\n`// Quadratic Koch Island 2\naxiom: F+F+F+F\nrules: \n F => F-FF+FF+F+F-F-FF+F+F-F-FF-FF+F\n\ndepth: 4\nangle: 90`,\n\n`// Quadratic Koch Island (Hasan Hosam variation)\naxiom: X+X+X+X+X+X+X+X\nrules: \n X => X+YF++YF-FX--FXFX-YF+X\n Y => -FX+YFYF++YF+FX--FX-YF\n\ndepth: 4\nangle: 45`,\n\n`// Koch Curve\naxiom: F+F+F+F\nrules: \n F => F+F-F-FF+F+F-F\n\ndepth: 4\nangle: 90`,\n\n`// Board\naxiom: F+F+F+F\nrules: \n F => FF+F+F+F+FF\n\ndepth: 4\nangle: 90`,\n\n`// Hilbert\naxiom: X\nrules: \n X => -YF+XFX+FY-\n Y => +XF-YFY-FX+\n\ndepth: 4\nangle: 90`,\n\n`// Sierpinski Arrowhead\naxiom: YF\nrules: \n X => YF+XF+Y\n Y => XF-YF-X\n\ndepth: 4\nangle: 60`,\n\n`// Von Koch Snowflake\naxiom: F++F++F\nrules: \n F => F-F++F-F\n\ndepth: 4\nangle: 60`,\n\n`// Cross\naxiom: F+F+F+F\nrules: \n F => F+FF++F+F\n\ndepth: 4\nangle: 90`,\n\n`// Cross 2\naxiom: F+F+F+F\nrules: \n F => F+F-F+F+F\n\ndepth: 4\nangle: 90`,\n\n`// Pentaplexity\naxiom: F++F++F++F++F\nrules: \n F => F++F++F|F-F++F\n\ndepth: 4\nangle: 36`,\n\n`// Tiles\naxiom: F+F+F+F\nrules: \n F => FF+F-F+F+FF\n\ndepth: 4\nangle: 90`,\n\n`// Rings\naxiom: F+F+F+F\nrules: \n F => FF+F+F+F+F+F-F\n\ndepth: 4\nangle: 90`,\n\n`// Dragon Curve\naxiom: FX\nrules: \n X => X+YF+\n Y => -FX-Y\n\ndepth: 4\nangle: 90`,\n\n`// Hexagonal Gosper\naxiom: XF\nrules: \n X => X+YF++YF-FX--FXFX-YF+\n Y => -FX+YFYF++YF+FX--FX-Y\n\ndepth: 4\nangle: 60`,\n\n`// Lvy curve\naxiom: F\nrules: \n F => -F++F-\n\ndepth: 4\nangle: 45`,\n\n`// Classic Sierpinski Curve\naxiom: F--XF--F--XF\nrules: \n X => XF+F+XF--F--XF+F+X\n\ndepth: 4\nangle: 45`,\n\n`// Krishna Anklets\naxiom: -X--X\nrules: \n X => XFX--XFX\n\ndepth: 4\nangle: 45`,\n\n`// Mango Leaf\naxiom: Y---Y\nrules: \n X => {F-F}{F-F}--[--X]{F-F}{F-F}--{F-F}{F-F}--\n Y => f-F+X+F-fY\n\ndepth: 4\nangle: 60`,\n\n`// Snake Kolam\naxiom: F+XF+F+XF\nrules: \n X => X{F-F-F}+XF+F+X{F-F-F}+X\n\ndepth: 4\nangle: 90`,\n\n`// Kolam\naxiom: (-D--D)\nrules: \n A => F++FFFF--F--FFFF++F++FFFF--F\n B => F--FFFF++F++FFFF--F--FFFF++F\n C => BFA--BFA\n D => CFC--CFC\n\ndepth: 4\nangle: 45`,\n\n  ]\n\nexport default function getCodeModel(scene) {\n  let model = {\n    setCode,\n    error: null,\n    randomize,\n    trueRandomize,\n    getExamples,\n    loadExample,\n    code: qs.get('code')\n  }\n  let lastPickedIndex = -1;\n\n  setCode(model.code);\n\n  return model;\n\n  function randomize() {\n    let index;\n    do { index = pickRandomIndex(standardCollection) } while (index === lastPickedIndex);\n    lastPickedIndex = index;\n    let code = standardCollection[lastPickedIndex];\n    setCode(code);\n    model.ignoreNextUpdate = true;\n    model.code = code;\n    return lastPickedIndex;\n  }\n\n  function trueRandomize() {\n    let length = Math.floor(Math.random() * 5) + 5; // 5-9 characters\n    let system = getRandomSystem(length);\n    let depth = Math.floor(Math.random() * 4) + 4; // depth 4-7\n\n    // Generate random color scheme\n    let colors = getRandomColors();\n    let useColors = true;\n\n    let code = `axiom: X\nrules:\n  X => ${system.X}\n  Y => ${system.Y}\n\ndepth: ${depth}\nangle: ${system.angle}`;\n\n    if (useColors && colors.length > 0) {\n      code += '\\nactions:';\n      colors.forEach((color, index) => {\n        let actionChar = String.fromCharCode(99 + index); // c, d, e, f, g...\n        code += `\\n  ${actionChar} => setColor('${color}')`;\n      });\n    }\n\n    setCode(code);\n    model.ignoreNextUpdate = true;\n    model.code = code;\n  }\n\n  function getExamples() {\n    return standardCollection.map((code, index) => {\n      // Extract name from comment at the beginning\n      let match = code.match(/\\/\\/\\s*(.+)/);\n      let name = match ? match[1].trim() : `Example ${index + 1}`;\n      return { name, code, index };\n    });\n  }\n\n  function loadExample(index) {\n    if (index >= 0 && index < standardCollection.length) {\n      lastPickedIndex = index;\n      let code = standardCollection[index];\n      setCode(code);\n      model.ignoreNextUpdate = true;\n      model.code = code;\n    }\n  }\n\n  function setCode(newCode) {\n    newCode = newCode.trim();\n    if (!newCode) {\n      model.error = 'Enter a system description above'\n      return;\n    }\n    try {\n      let system = parseExpression(newCode);\n      if (system) {\n        // TODO: I messed up with grammar, and seems like string value takes precedence over\n        // axiom clause. A little hack here to put them back on the same page until better fix:\n        if (system.axiom) system.start = system.axiom;\n        scene.setSystem(system);\n        if (scene.isComplete()) {\n          model.error = null;\n        } else {\n          model.error = 'The system limit reached.\\nRendering first 1,000,000 characters'\n        }\n        qs.set('code', newCode);\n      } else {\n        model.error = 'Could not parse the input string';\n      }\n    } catch (e) {\n      model.error = e.message;\n    }\n  }\n}\n\nfunction getInitialCode() {\n  // todo: query state?\n  return `axiom: X\nrules:\n  X => -YF+XFX+FY-\n  Y => +XF-YFY-FX+\n\ndepth: 5\nstepsPerFrame: 10\nwidth: 2\n\nactions:\n  - => rotate(-90)\n  + => rotate(90)\n  F => draw()\n`\n}\n\n\nfunction getRandomSystem(length) {\n  let states = 'FXY';\n  let colorChars = 'cdefg'; // Color action characters\n\n  let res = [];\n  let lastCh = '';\n  while (res.length < length) {\n    let ch = pickChar();\n    if (ch === '+' && lastCh === '-') ch = '-'\n    else if (ch === '-' && lastCh === '+') ch = '+';\n    else if (ch === 'F' && lastCh === 'F') ch = Math.random() < 0.5 ? 'X': 'Y';\n    res.push(ch);\n    lastCh = ch;\n  }\n\n  for (let ch of 'FXY') {\n    if (res.indexOf(ch) < 0) {\n      res[Math.floor(Math.random() * res.length)] = ch;\n    }\n  }\n\n  let X = res.join('');\n  let Y = res.reverse().map( x => {\n    if (x === '+') return '-';\n    if (x === '-') return '+';\n    if (x === 'Y') return 'X';\n    if (x === 'X') return 'Y';\n    // Keep color characters the same in Y\n    return x;\n  } ).join('')\n\n  let angle = Math.random() < 0.5 ? 60 : 90;\n  if (angle === 90 && ( X.match(/(\\+\\+|\\+-|--)/) || Y.match(/(\\+\\+|\\+-|--)/))) angle = 45;\n  return {X, Y, angle}\n\n  function pickChar() {\n    let r = Math.random();\n    if (r < 0.78) {\n      r = Math.random();\n      return states[Math.floor(states.length * r)]\n    } else if (r < 0.89) {\n      return '+';\n    } else if (r < 0.95) {\n      return '-';\n    } else {\n      return Math.random() < 0.5 ? '+' : '-';\n    }\n  }\n}\n\nfunction getRandomColors() {\n  const colorPalettes = [\n    // Nature greens\n    ['green', 'lime', 'lightgreen', 'darkgreen'],\n    // Autumn\n    ['goldenrod', 'gold', 'orange', 'brown'],\n    // Purples\n    ['mediumpurple', 'violet', 'purple', 'orchid'],\n    // Blues\n    ['dodgerblue', 'skyblue', 'steelblue', 'navy'],\n    // Warm\n    ['coral', 'salmon', 'tomato', 'crimson'],\n    // Cool\n    ['cyan', 'turquoise', 'teal', 'aquamarine'],\n    // Mixed vibrant\n    ['red', 'blue', 'green', 'yellow'],\n    // Pastels\n    ['lightcoral', 'lightblue', 'lightgreen', 'lightyellow'],\n    // Earth tones\n    ['sienna', 'peru', 'chocolate', 'saddlebrown'],\n    // Pink/Red\n    ['hotpink', 'deeppink', 'pink', 'lightpink']\n  ];\n\n  let palette = colorPalettes[Math.floor(Math.random() * colorPalettes.length)];\n  let numColors = Math.floor(Math.random() * 3) + 2; // 2-4 colors\n\n  return palette.slice(0, numColors);\n}\n\nfunction pickRandomIndex(arr) {\n  return Math.floor(Math.random() * arr.length);\n}\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('codemirror',{ref:\"editor\",attrs:{\"options\":{\n    viewportMargin: Infinity,\n    theme: 'lsystem',\n    mode: 'application/lsystem',\n  }},model:{value:(_vm.model.code),callback:function ($$v) {_vm.$set(_vm.model, \"code\", $$v)},expression:\"model.code\"}}),(_vm.model.error)?_c('div',{staticClass:\"error-container\"},[_c('pre',{staticClass:\"error hl\"},[_vm._v(_vm._s(_vm.model.error))])]):_vm._e()],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import eventify from 'ngraph.events';\nconst bus = eventify({});\nexport default bus;","<template>\n<div>\n  <codemirror v-model='model.code' ref='editor' :options=\"{\n    viewportMargin: Infinity,\n    theme: 'lsystem',\n    mode: 'application/lsystem',\n  }\"></codemirror>\n  <div class='error-container' v-if='model.error'>\n    <pre class='error hl'>{{model.error}}</pre>\n  </div> \n</div>\n</template>\n\n<script>\nimport bus from './bus';\nimport { codemirror } from 'vue-codemirror-lite';\nvar CodeMirror = require('codemirror/lib/codemirror.js')\nrequire('codemirror/addon/comment/comment.js');\nrequire('./lmode.js')(CodeMirror)\n\nfunction toggleComment(cm) {\n  cm.toggleComment({\n    indent: true,\n    lineComment: '//'\n  });\n}\n\nfunction handleUp(cm) {\n  return updateValueIfNeededBy(1, cm);\n}\n\nfunction handleDown(cm) {\n  return updateValueIfNeededBy(-1, cm);\n}\n\nfunction updateValueIfNeededBy(delta, cm) {\n  let cursor = cm.getCursor();\n  let token = cm.getTokenAt(cursor);\n  if (!token || token.type !== 'number') return CodeMirror.Pass;\n\n  let from = {line: cursor.line, ch: token.start};\n  let end = {line: cursor.line, ch: token.end};\n\n  let v = Number.parseFloat(token.string);\n  let line = cm.getLine(cursor.line);\n  if (from.ch > 0) {\n    // minus is not part of the number.\n    if (line[from.ch - 1] === '-') {\n      v *= -1;\n      from.ch -= 1;\n    }\n  }\n\n  \n  v += delta;\n  var doc = cm.getDoc();\n  doc.replaceRange(String(v), from, end);\n  bus.fire('immediate-update')\n}\n//require('./glslmode')(CodeMirror);\nexport default {\n  name: 'CodeEditor',\n  props: ['model'],\n  components: {\n    codemirror\n  },\n\n  mounted() {\n    bus.on('settings-collapsed', refreshEditor, this);\n    bus.on('immediate-update', this.setImmediateUpdate, this);\n    this.$refs.editor.editor.setOption('extraKeys', {\n      'Cmd-/': toggleComment,\n      'Ctrl-/': toggleComment,\n      'Shift-Up': handleUp,\n      'Shift-Down': handleDown\n    });\n  },\n\n  beforeDestroy() {\n    bus.off('settings-collapsed', refreshEditor, this);\n    bus.off('immediate-update', this.setImmediateUpdate, this);\n  },\n  watch: {\n    'model.code': function() {\n      if (this.model.ignoreNextUpdate) {\n        this.model.ignoreNextUpdate = false;\n        return;\n      }\n      if (this.pendingSetCode) {\n        clearTimeout(this.pendingSetCode);\n      }\n      if (this.isImmediate) {\n        this.model.setCode(this.model.code);\n        this.pendingSetCode = 0;\n        return;\n      } \n\n      // We don't want to update code on each key stroke. This would have negative\n      // impact on performance.\n      this.pendingSetCode = setTimeout(() => {\n        this.model.setCode(this.model.code);\n        this.pendingSetCode = 0;\n      }, 300);\n    },\n  },\n  data() {\n    return {\n      clearImmediate: 0,\n      isImmediate: false\n    }\n  },\n  methods: {\n    setImmediateUpdate() {\n      if (this.clearImmediate) clearTimeout(this.clearImmediate);\n      this.clearImmediate = setTimeout(() => this.isImmediate = false, 30);\n      this.isImmediate = true;\n    }\n  }\n}\nfunction refreshEditor(isCollapsed) {\n  // Code mirror sometimes is not visible https://stackoverflow.com/questions/8349571/codemirror-editor-is-not-loading-content-until-clicked\n  if (!isCollapsed) {\n    setTimeout(() => {\n      this.$refs.editor.editor.refresh()\n    }, 10);\n  }\n}\n</script>","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./CodeEditor.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./CodeEditor.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./CodeEditor.vue?vue&type=template&id=e819de66\"\nimport script from \"./CodeEditor.vue?vue&type=script&lang=js\"\nexport * from \"./CodeEditor.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div id=\"app\" :class='{\"light-theme\": isLightTheme}'>\n    <button class='sidebar-toggle' @click='toggleSidebar' :class='{\"sidebar-open\": sidebarOpen}'>\n      <span class='toggle-icon'>{{ sidebarOpen ? '' : '' }}</span>\n    </button>\n    <button class='theme-toggle' @click='toggleTheme' :title='isLightTheme ? \"Switch to dark theme\" : \"Switch to light theme\"'>\n      <span class='theme-icon'>{{ isLightTheme ? '' : '' }}</span>\n    </button>\n    <div class='sidebar' :class='{\"sidebar-open\": sidebarOpen}'>\n      <div class='editor-container'>\n        <div class=\"section\">\n        <div class='title'>\n          L-Systems\n          <a href=\"https://zansara.dev\"><small> by Sara Zan </small></a>\n          <a href=\"https://github.com/ZanSara/L-systems\" target=\"_blank\" class=\"github-link\" title=\"View source on GitHub\">\n            <svg viewBox=\"0 0 16 16\" width=\"16\" height=\"16\" fill=\"currentColor\">\n              <path d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z\"/>\n            </svg>\n          </a>\n        </div>\n        <div class='help' v-if='syntaxHelpVisible'>\n          L-Systems are described very well on <a href='http://paulbourke.net/fractals/lsys/' target=\"_blank\">Paul Bourke's website</a>.\n          <p>The following is the list of available sections:\n            <ul>\n              <li><strong>axiom</strong>: initial state of the system</li>\n              <li><strong>rules</strong>: list of rewrite rules that are applied on each iteration</li>\n              <li><strong>depth</strong>: how deep we are allowed to go recursively</li>\n              <li><strong>angle</strong>: if specified, this argument governs rotation angle. Can be overridden with <strong>actions</strong></li>\n              <li><strong>actions</strong>: list of graphic commands that are triggered by a matching character in the evolved system.\n                The following is the list of available actions:\n                <ul>\n                  <li><strong>draw(x)</strong> draw <code>x</code> units in current direction</li>\n                  <li><strong>move(x)</strong> move <code>x</code> units in current direction without drawing</li>\n                  <li><strong>rotate(deg)</strong>  rotate current direction <code>deg</code> degrees around Z axis</li>\n                  <li><strong>rotateX(deg)</strong> rotate current direction <code>deg</code> degrees around X axis</li>\n                  <li><strong>rotateY(deg)</strong> rotate current direction <code>deg</code> degrees around Y axis</li>\n                  <li><strong>push()</strong> saves current render state onto stack</li>\n                  <li><strong>pop()</strong> restores previously saved render state</li>\n                  <li><strong>setColor(color)</strong> set the current color value, '#ffa500' or 'orange'.</li>\n                  <li><strong>swapAngle()</strong> swaps the meaning of `+` and `-`.</li>\n                </ul>\n\n                <p>By default the following actions are added automatically:</p>\n<pre><code>actions:\n  F => draw(10)\n  f => move(10)\n  + => rotate(60)\n  - => rotate(-60)\n  & => swapAngle()\n  [ => push()\n  ] => pop()\n</code></pre>\n\n              </li>\n\n              <li><strong>width</strong>: width in pixels of the drawn line</li>\n              <li><strong>color</strong>: color of the line. Accepts names and hex. E.g. <code>blue</code>, works the same as <code>#0000ff</code></li>\n              <li><strong>stepsPerFrame</strong>: how many steps we are allowed to render per single frame.\n              If set to <code>-1</code> the scene is rendered immediately. This could be dangerous on deep\n              systems, as the entire system traversal may exhaust the browser's resources.\n              </li>\n\n              <li><strong>direction</strong>: three numbers separated by coma <code>x, y, z</code> that set initial direction</li>\n              <li><strong>position</strong>: three numbers separated by coma <code>x, y, z</code> that set initial position</li>\n            </ul>\n          </p>\n        </div>\n        <div class='editor-wrapper'>\n          <a class='syntax-help-button' :class='{\"syntax-visible\": syntaxHelpVisible}' href='#' @click.prevent='syntaxHelpVisible = !syntaxHelpVisible' title='click to learn more about syntax'>?</a>\n          <code-editor v-if='codeEditorModel' :model='codeEditorModel' class='code-editor-container'></code-editor>\n        </div>\n\n        <div class='view-controls'>\n          <div class='rotation-control'>\n            <label for='line-width'>Line Width:</label>\n            <input\n              id='line-width'\n              type='range'\n              min='1'\n              max='30'\n              step='1'\n              v-model.number='lineWidth'\n              @input='updateLineWidth'\n            />\n            <span class='rotation-value'>{{ lineWidth }}px</span>\n          </div>\n          <div class='grid-toggle'>\n            <label for='show-grid'>Show Grid:</label>\n            <input\n              id='show-grid'\n              type='checkbox'\n              v-model='showGrid'\n              @change='toggleGrid'\n              class='grid-checkbox'\n            />\n            <span class='toggle-switch' :class='{\"active\": showGrid}' @click='showGrid = !showGrid; toggleGrid()'></span>\n          </div>\n          <div class='rotation-control'>\n            <label for='rotation'>Rotation:</label>\n            <input\n              id='rotation'\n              type='range'\n              min='0'\n              max='360'\n              step='1'\n              v-model.number='rotation'\n              @input='updateRotation'\n            />\n            <span class='rotation-value'>{{ rotation }}</span>\n          </div>\n        </div>\n\n        <div class='controls'>\n          <a href=\"#\" class='album-button' @click.prevent='pickFromAlbum'>Pick from Examples</a>\n          <a href=\"#\" class='randomize-button' @click.prevent='trueRandomize'>Random Values</a>\n          <a href=\"#\" class='stop-button' @click.prevent='stopGeneration'>Stop Generation</a>\n          <a href=\"#\" class='save-button' @click.prevent='toSVGFile'>Save as SVG</a>\n        </div>\n\n        <div class=\"section examples-section\">\n          <div class='title'>Examples</div>\n          <div class='examples-list'>\n            <a\n              v-for='(example, index) in examples'\n              :key='index'\n              href='#'\n              class='example-item'\n              :class='{\"active\": currentExampleIndex === example.index}'\n              @click.prevent='loadExample(example.index)'\n            >\n              {{ example.name }}\n            </a>\n          </div>\n        </div>\n</div>\n      </div>\n    </div>\n\n    <!-- Selection Mask Overlay -->\n    <div v-if='showSelectionMask' class='selection-overlay'>\n      <div\n        class='selection-mask'\n        :style='{\n          left: selectionRect.left + \"px\",\n          top: selectionRect.top + \"px\",\n          width: selectionRect.width + \"px\",\n          height: selectionRect.height + \"px\"\n        }'\n        @mousedown='startDrag'\n      >\n        <div class='selection-border'></div>\n        <div class='resize-handle nw' @mousedown.stop='startResize(\"nw\", $event)'></div>\n        <div class='resize-handle ne' @mousedown.stop='startResize(\"ne\", $event)'></div>\n        <div class='resize-handle sw' @mousedown.stop='startResize(\"sw\", $event)'></div>\n        <div class='resize-handle se' @mousedown.stop='startResize(\"se\", $event)'></div>\n        <div class='resize-handle n' @mousedown.stop='startResize(\"n\", $event)'></div>\n        <div class='resize-handle s' @mousedown.stop='startResize(\"s\", $event)'></div>\n        <div class='resize-handle w' @mousedown.stop='startResize(\"w\", $event)'></div>\n        <div class='resize-handle e' @mousedown.stop='startResize(\"e\", $event)'></div>\n      </div>\n      <div class='selection-controls'>\n        <button @click='confirmSelection' class='selection-confirm-btn'>\n          Confirm Selection\n        </button>\n        <button @click='cancelSelection' class='selection-cancel-btn'>\n          Cancel\n        </button>\n      </div>\n    </div>\n\n    <!-- Save SVG Modal -->\n    <div v-if='showSaveModal' class='modal-overlay' @click='showSaveModal = false'>\n      <div class='modal-content' @click.stop>\n        <h3>Save as SVG</h3>\n        <p>Choose which theme version(s) to save:</p>\n        <div class='modal-buttons'>\n          <button @click='saveSVGVersion(\"light\")' class='modal-btn light-btn'>\n             Light Theme\n            <span class='filename'>l-system-light.svg</span>\n          </button>\n          <button @click='saveSVGVersion(\"dark\")' class='modal-btn dark-btn'>\n             Dark Theme\n            <span class='filename'>l-system-dark.svg</span>\n          </button>\n          <button @click='saveSVGVersion(\"both\")' class='modal-btn both-btn'>\n             Both Themes\n            <span class='filename'>2 files</span>\n          </button>\n        </div>\n        <button @click='showSaveModal = false' class='modal-cancel'>Cancel</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport createScene from './createScene';\nimport getCodeModel from './getCodeModel';\nimport CodeEditor from './CodeEditor';\n\nexport default {\n  name: 'App',\n  components: {\n    CodeEditor\n  },\n  data() {\n    return {\n      codeEditorModel: null,\n      sidebarOpen: true,\n      syntaxHelpVisible: false,\n      currentExampleIndex: -1,\n      examples: [],\n      isLightTheme: false,\n      showSaveModal: false,\n      showSelectionMask: false,\n      selectionRect: { left: 100, top: 100, width: 400, height: 400 },\n      isDragging: false,\n      isResizing: false,\n      resizeHandle: null,\n      dragStartPos: { x: 0, y: 0 },\n      lineWidth: 2,\n      showGrid: false,\n      rotation: 0\n    }\n  },\n  mounted() {\n    const canvas = document.querySelector('#scene');\n    this.scene = createScene(canvas);\n\n    // Store canvas reference for rotation\n    this.canvas = canvas;\n\n    // Load theme preference from localStorage FIRST\n    const savedTheme = localStorage.getItem('theme');\n    if (savedTheme === 'light') {\n      this.isLightTheme = true;\n    }\n\n    // Set theme BEFORE loading code so default color is correct\n    this.scene.setTheme(this.isLightTheme);\n\n    // Set body background to match theme (fixes rotation artifact)\n    this.updateBodyBackground();\n\n    // Now load the code model with the correct default color\n    this.codeEditorModel = getCodeModel(this.scene);\n    this.examples = this.codeEditorModel.getExamples().sort((a, b) =>\n      a.name.localeCompare(b.name)\n    );\n\n    // Add global mouse event listeners for drag and resize\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  },\n  beforeDestroy() {\n    this.scene.dispose();\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  },\n  methods: {\n    toSVGFile() {\n      // Initialize selection rect to center of viewport\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n      this.selectionRect = {\n        left: viewportWidth / 2 - 200,\n        top: viewportHeight / 2 - 200,\n        width: 400,\n        height: 400\n      };\n      this.showSelectionMask = true;\n    },\n    saveSVGVersion(version) {\n      const currentTheme = this.isLightTheme;\n\n      // Convert screen coordinates to world coordinates\n      const customViewBox = this.getCustomViewBox();\n\n      if (version === 'light') {\n        if (!this.isLightTheme) {\n          this.scene.setTheme(true);\n          this.codeEditorModel.setCode(this.codeEditorModel.code);\n        }\n        this.scene.saveToSVG('l-system-light.svg', customViewBox);\n        if (!currentTheme) {\n          setTimeout(() => {\n            this.scene.setTheme(false);\n            this.codeEditorModel.setCode(this.codeEditorModel.code);\n          }, 100);\n        }\n      } else if (version === 'dark') {\n        if (this.isLightTheme) {\n          this.scene.setTheme(false);\n          this.codeEditorModel.setCode(this.codeEditorModel.code);\n        }\n        this.scene.saveToSVG('l-system-dark.svg', customViewBox);\n        if (currentTheme) {\n          setTimeout(() => {\n            this.scene.setTheme(true);\n            this.codeEditorModel.setCode(this.codeEditorModel.code);\n          }, 100);\n        }\n      } else if (version === 'both') {\n        // Save dark version\n        if (this.isLightTheme) {\n          this.scene.setTheme(false);\n          this.codeEditorModel.setCode(this.codeEditorModel.code);\n        }\n        this.scene.saveToSVG('l-system-dark.svg', customViewBox);\n\n        // Wait a bit, then save light version\n        setTimeout(() => {\n          this.scene.setTheme(true);\n          this.codeEditorModel.setCode(this.codeEditorModel.code);\n          this.scene.saveToSVG('l-system-light.svg', customViewBox);\n\n          // Restore original theme\n          if (!currentTheme) {\n            setTimeout(() => {\n              this.scene.setTheme(false);\n              this.codeEditorModel.setCode(this.codeEditorModel.code);\n            }, 100);\n          }\n        }, 200);\n      }\n\n      this.showSaveModal = false;\n    },\n    getCustomViewBox() {\n      // Get the scene object from w-gl\n      const wglScene = this.scene.getScene();\n\n      // Convert screen coordinates to world coordinates\n      const topLeft = wglScene.getSceneCoordinate(\n        this.selectionRect.left,\n        this.selectionRect.top\n      );\n      const bottomRight = wglScene.getSceneCoordinate(\n        this.selectionRect.left + this.selectionRect.width,\n        this.selectionRect.top + this.selectionRect.height\n      );\n\n      return {\n        left: topLeft.x,\n        top: topLeft.y,\n        right: bottomRight.x,\n        bottom: bottomRight.y\n      };\n    },\n    toggleSidebar() {\n      this.sidebarOpen = !this.sidebarOpen;\n    },\n    pickFromAlbum() {\n      const index = this.codeEditorModel.randomize();\n      this.currentExampleIndex = index;\n    },\n    trueRandomize() {\n      this.codeEditorModel.trueRandomize();\n      this.currentExampleIndex = -1;\n    },\n    loadExample(index) {\n      this.currentExampleIndex = index;\n      this.codeEditorModel.loadExample(index);\n    },\n    stopGeneration() {\n      if (this.scene) {\n        this.scene.stop();\n      }\n    },\n    toggleTheme() {\n      this.isLightTheme = !this.isLightTheme;\n      localStorage.setItem('theme', this.isLightTheme ? 'light' : 'dark');\n      if (this.scene) {\n        this.scene.setTheme(this.isLightTheme);\n        this.updateBodyBackground();\n        // Reload the current code to apply the new default color\n        if (this.codeEditorModel && this.codeEditorModel.code) {\n          this.codeEditorModel.setCode(this.codeEditorModel.code);\n        }\n      }\n    },\n    updateBodyBackground() {\n      // Update body background to match the canvas theme\n      // This prevents white showing through when canvas is rotated\n      document.body.style.backgroundColor = this.isLightTheme ? '#ffffff' : '#000000';\n    },\n    updateLineWidth() {\n      if (this.scene && this.codeEditorModel && this.codeEditorModel.code) {\n        this.scene.setLineWidth(this.lineWidth);\n        this.codeEditorModel.setCode(this.codeEditorModel.code);\n      }\n    },\n    toggleGrid() {\n      if (this.scene) {\n        this.scene.setGridVisible(this.showGrid);\n      }\n    },\n    updateRotation() {\n      if (this.canvas) {\n        // Apply CSS rotation directly to the canvas\n        this.canvas.style.transform = `rotate(${this.rotation}deg)`;\n      }\n    },\n    startDrag(event) {\n      this.isDragging = true;\n      this.dragStartPos = {\n        x: event.clientX - this.selectionRect.left,\n        y: event.clientY - this.selectionRect.top\n      };\n    },\n    startResize(handle, event) {\n      this.isResizing = true;\n      this.resizeHandle = handle;\n      this.dragStartPos = {\n        x: event.clientX,\n        y: event.clientY,\n        rect: { ...this.selectionRect }\n      };\n    },\n    handleMouseMove(event) {\n      if (this.isDragging) {\n        this.selectionRect.left = event.clientX - this.dragStartPos.x;\n        this.selectionRect.top = event.clientY - this.dragStartPos.y;\n      } else if (this.isResizing) {\n        const dx = event.clientX - this.dragStartPos.x;\n        const dy = event.clientY - this.dragStartPos.y;\n        const startRect = this.dragStartPos.rect;\n\n        switch (this.resizeHandle) {\n          case 'nw':\n            this.selectionRect.left = startRect.left + dx;\n            this.selectionRect.top = startRect.top + dy;\n            this.selectionRect.width = startRect.width - dx;\n            this.selectionRect.height = startRect.height - dy;\n            break;\n          case 'ne':\n            this.selectionRect.top = startRect.top + dy;\n            this.selectionRect.width = startRect.width + dx;\n            this.selectionRect.height = startRect.height - dy;\n            break;\n          case 'sw':\n            this.selectionRect.left = startRect.left + dx;\n            this.selectionRect.width = startRect.width - dx;\n            this.selectionRect.height = startRect.height + dy;\n            break;\n          case 'se':\n            this.selectionRect.width = startRect.width + dx;\n            this.selectionRect.height = startRect.height + dy;\n            break;\n          case 'n':\n            this.selectionRect.top = startRect.top + dy;\n            this.selectionRect.height = startRect.height - dy;\n            break;\n          case 's':\n            this.selectionRect.height = startRect.height + dy;\n            break;\n          case 'w':\n            this.selectionRect.left = startRect.left + dx;\n            this.selectionRect.width = startRect.width - dx;\n            break;\n          case 'e':\n            this.selectionRect.width = startRect.width + dx;\n            break;\n        }\n\n        // Ensure minimum size\n        if (this.selectionRect.width < 50) this.selectionRect.width = 50;\n        if (this.selectionRect.height < 50) this.selectionRect.height = 50;\n      }\n    },\n    handleMouseUp() {\n      this.isDragging = false;\n      this.isResizing = false;\n      this.resizeHandle = null;\n    },\n    confirmSelection() {\n      this.showSelectionMask = false;\n      this.showSaveModal = true;\n    },\n    cancelSelection() {\n      this.showSelectionMask = false;\n    }\n  }\n\n}\n</script>\n\n<style lang='stylus'>\n@import \"./shared.styl\";\n@import \"./editor.styl\";\n\n// Dark Blueprint color palette\nblueprint-bg = #0a1628;\nblueprint-border = #1e3a5f;\nblueprint-accent = #3a7bd5;\nblueprint-text = #a8d4ff;\nblueprint-bright = #6eb5ff;\nblueprint-dark = #050d18;\nblueprint-grid = rgba(62, 120, 213, 0.15);\n\nprimary-text = #e8f4ff;\nhelp-text-color = #6eb5ff;\nhelp-background = #0d1b2e;\n\n// Light theme color palette\nlight-bg = #f0f4f8;\nlight-border = #b8c9db;\nlight-accent = #2563eb;\nlight-text = #1e3a5f;\nlight-bright = #1d4ed8;\nlight-dark = #e5ebf1;\nlight-grid = rgba(37, 99, 235, 0.08);\n\nlight-primary-text = #0f1419;\nlight-help-text-color = #2563eb;\nlight-help-background = #dfe6ee;\n\n#app {\n  overflow: hidden;\n  max-height: 100%;\n  position: absolute;\n  z-index: 1;\n  color: primary-text;\n  background: window-background;\n}\n\n.sidebar-toggle,\n.theme-toggle {\n  position: fixed;\n  top: 16px;\n  z-index: 1000;\n  width: 44px;\n  height: 44px;\n  background: blueprint-bg;\n  border: 2px solid blueprint-accent;\n  border-radius: 4px;\n  color: blueprint-bright;\n  cursor: pointer;\n  font-size: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4),\n              0 0 20px rgba(58, 123, 213, 0.2),\n              inset 0 1px 0 rgba(255, 255, 255, 0.1);\n\n  &:hover {\n    background: #0f2140;\n    border-color: blueprint-bright;\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5),\n                0 0 30px rgba(58, 123, 213, 0.4),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\n    transform: translateY(-1px);\n  }\n\n  .toggle-icon,\n  .theme-icon {\n    line-height: 1;\n    user-select: none;\n  }\n}\n\n.sidebar-toggle {\n  left: 16px;\n\n  &.sidebar-open {\n    left: 516px;\n  }\n}\n\n.theme-toggle {\n  right: 16px;\n  top: auto;\n  bottom: 16px;\n}\n\n.section {\n  padding: 16px;\n}\n\n.sidebar {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 500px;\n  height: 100vh;\n  overflow: hidden;\n  background: blueprint-bg;\n  border-right: 2px solid blueprint-accent;\n  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5),\n              0 0 40px rgba(58, 123, 213, 0.15);\n  transform: translateX(-100%);\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  z-index: 999;\n\n  // Blueprint grid pattern\n  background-image:\n    linear-gradient(blueprint-grid 1px, transparent 1px),\n    linear-gradient(90deg, blueprint-grid 1px, transparent 1px);\n  background-size: 20px 20px;\n  background-position: 0 0, 0 0;\n\n  &.sidebar-open {\n    transform: translateX(0);\n  }\n}\n\n.editor-container {\n  height: 100vh;\n  overflow-y: auto;\n  overflow-x: hidden;\n  background: linear-gradient(to bottom, blueprint-dark 0%, blueprint-bg 100%);\n\n  a {\n    color: blueprint-bright;\n    text-decoration: none;\n    transition: all 0.2s;\n\n    &:hover {\n      color: primary-text;\n    }\n  }\n\n  // Custom scrollbar\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: blueprint-dark;\n    border-left: 1px solid blueprint-border;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: blueprint-accent;\n    border-radius: 4px;\n\n    &:hover {\n      background: blueprint-bright;\n    }\n  }\n}\n\n.error-container {\n  color: white;\n  background: #d32f2f;\n  padding: 8px 16px;\n  border-left: 3px solid #ff5252;\n  margin: 8px;\n}\n\n.title {\n  color: primary-text;\n  font-size: 20px;\n  font-weight: 500;\n  padding: 8px 0;\n  margin-bottom: 12px;\n  border-bottom: 2px solid blueprint-border;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  font-family: 'Courier New', monospace;\n\n  .github-link {\n    display: inline-flex;\n    align-items: center;\n    margin-left: 8px;\n    color: blueprint-bright;\n    border: none;\n    opacity: 0.8;\n    transition: all 0.2s;\n    vertical-align: middle;\n\n    svg {\n      width: 18px;\n      height: 18px;\n    }\n\n    &:hover {\n      opacity: 1;\n      color: primary-text;\n      transform: scale(1.1);\n    }\n  }\n}\n\n.help {\n  margin: 12px -16px 16px -16px;\n  padding: 20px;\n  background: help-background;\n  color: blueprint-text;\n  border: 1px solid blueprint-border;\n  border-left: none;\n  border-right: none;\n\n  a {\n    border-bottom: 1px dashed blueprint-border;\n    color: primary-text;\n    font-weight: 500;\n  }\n\n  ul {\n    padding: 0;\n    list-style-type: none;\n\n    ul {\n      padding-left: 20px;\n      list-style-type: none;\n      margin-top: 8px;\n    }\n\n    strong {\n      color: blueprint-bright;\n      font-weight: 600;\n      font-family: 'Courier New', monospace;\n    }\n\n    code {\n      color: #4ec9b0;\n      background: rgba(0, 0, 0, 0.3);\n      padding: 2px 6px;\n      border-radius: 3px;\n      font-size: 13px;\n    }\n\n    li {\n      margin: 8px 0;\n      line-height: 1.6;\n    }\n  }\n\n  pre {\n    background: rgba(0, 0, 0, 0.4);\n    border: 1px solid blueprint-border;\n    border-radius: 4px;\n    padding: 12px;\n    margin: 12px 0;\n\n    code {\n      background: none;\n      padding: 0;\n    }\n  }\n}\n\n.editor-wrapper {\n  position: relative;\n  margin: 16px 0;\n}\n\n.code-editor-container {\n  width: 100%;\n}\n\n.syntax-help-button {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  z-index: 10;\n  font-size: 14px;\n  font-style: normal;\n  color: help-text-color;\n  text-transform: none;\n  letter-spacing: 0;\n  padding: 6px 12px;\n  border: 1px solid blueprint-border;\n  border-radius: 3px;\n  background: blueprint-dark;\n  transition: all 0.2s;\n  text-decoration: none;\n\n  &:hover {\n    background: blueprint-border;\n    border-color: blueprint-accent;\n  }\n\n  &.syntax-visible {\n    background: blueprint-accent;\n    color: white;\n    border-color: blueprint-bright;\n  }\n}\n\n.line-width-control {\n  padding: 16px;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  background: rgba(30, 58, 95, 0.2);\n  border: 1px solid blueprint-border;\n  border-radius: 4px;\n  margin: 16px 0;\n\n  label {\n    color: blueprint-text;\n    font-size: 14px;\n    font-weight: 500;\n    min-width: 80px;\n  }\n\n  input[type='range'] {\n    flex: 1;\n    height: 6px;\n    background: blueprint-border;\n    border-radius: 3px;\n    outline: none;\n    -webkit-appearance: none;\n\n    &::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 18px;\n      height: 18px;\n      border-radius: 50%;\n      background: blueprint-bright;\n      cursor: pointer;\n      border: 2px solid blueprint-bg;\n      box-shadow: 0 0 10px rgba(110, 181, 255, 0.5);\n      transition: all 0.2s;\n\n      &:hover {\n        background: primary-text;\n        box-shadow: 0 0 15px rgba(110, 181, 255, 0.8);\n        transform: scale(1.1);\n      }\n    }\n\n    &::-moz-range-thumb {\n      width: 18px;\n      height: 18px;\n      border-radius: 50%;\n      background: blueprint-bright;\n      cursor: pointer;\n      border: 2px solid blueprint-bg;\n      box-shadow: 0 0 10px rgba(110, 181, 255, 0.5);\n      transition: all 0.2s;\n\n      &:hover {\n        background: primary-text;\n        box-shadow: 0 0 15px rgba(110, 181, 255, 0.8);\n        transform: scale(1.1);\n      }\n    }\n  }\n\n  .width-value {\n    color: blueprint-bright;\n    font-size: 14px;\n    font-weight: 600;\n    min-width: 45px;\n    text-align: right;\n    font-family: 'Courier New', monospace;\n  }\n}\n\n.view-controls {\n  padding: 16px;\n  background: rgba(30, 58, 95, 0.2);\n  border: 1px solid blueprint-border;\n  border-radius: 4px;\n  margin: 16px 0;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.grid-toggle {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  label {\n    color: blueprint-text;\n    font-size: 14px;\n    font-weight: 500;\n    min-width: 80px;\n  }\n\n  .grid-checkbox {\n    display: none;\n  }\n\n  .toggle-switch {\n    position: relative;\n    width: 48px;\n    height: 24px;\n    background: blueprint-border;\n    border: 2px solid blueprint-border;\n    border-radius: 12px;\n    cursor: pointer;\n    transition: all 0.3s;\n\n    &::after {\n      content: '';\n      position: absolute;\n      top: 2px;\n      left: 2px;\n      width: 16px;\n      height: 16px;\n      background: blueprint-text;\n      border-radius: 50%;\n      transition: all 0.3s;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    }\n\n    &.active {\n      background: blueprint-accent;\n      border-color: blueprint-bright;\n\n      &::after {\n        left: 26px;\n        background: blueprint-bright;\n        box-shadow: 0 2px 8px rgba(110, 181, 255, 0.6);\n      }\n    }\n\n    &:hover {\n      border-color: blueprint-accent;\n    }\n  }\n}\n\n.rotation-control {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n\n  label {\n    color: blueprint-text;\n    font-size: 14px;\n    font-weight: 500;\n    min-width: 80px;\n  }\n\n  input[type='range'] {\n    flex: 1;\n    height: 6px;\n    background: blueprint-border;\n    border-radius: 3px;\n    outline: none;\n    -webkit-appearance: none;\n\n    &::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 18px;\n      height: 18px;\n      border-radius: 50%;\n      background: blueprint-bright;\n      cursor: pointer;\n      border: 2px solid blueprint-bg;\n      box-shadow: 0 0 10px rgba(110, 181, 255, 0.5);\n      transition: all 0.2s;\n\n      &:hover {\n        background: primary-text;\n        box-shadow: 0 0 15px rgba(110, 181, 255, 0.8);\n        transform: scale(1.1);\n      }\n    }\n\n    &::-moz-range-thumb {\n      width: 18px;\n      height: 18px;\n      border-radius: 50%;\n      background: blueprint-bright;\n      cursor: pointer;\n      border: 2px solid blueprint-bg;\n      box-shadow: 0 0 10px rgba(110, 181, 255, 0.5);\n      transition: all 0.2s;\n\n      &:hover {\n        background: primary-text;\n        box-shadow: 0 0 15px rgba(110, 181, 255, 0.8);\n        transform: scale(1.1);\n      }\n    }\n  }\n\n  .rotation-value {\n    color: blueprint-bright;\n    font-size: 14px;\n    font-weight: 600;\n    min-width: 45px;\n    text-align: right;\n    font-family: 'Courier New', monospace;\n  }\n}\n\n.examples-section {\n  border-top: 2px solid blueprint-border;\n  margin-top: 16px;\n  padding-top: 0;\n\n  .title {\n    margin: 12px 0;\n  }\n\n  .examples-list {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 6px;\n    max-height: 300px;\n    overflow-y: auto;\n    padding-right: 4px;\n\n    // Custom scrollbar\n    &::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    &::-webkit-scrollbar-track {\n      background: blueprint-dark;\n      border-radius: 3px;\n    }\n\n    &::-webkit-scrollbar-thumb {\n      background: blueprint-accent;\n      border-radius: 3px;\n\n      &:hover {\n        background: blueprint-bright;\n      }\n    }\n\n    .example-item {\n      padding: 10px 12px;\n      background: rgba(30, 58, 95, 0.3);\n      border: 1px solid blueprint-border;\n      border-left: 3px solid blueprint-border;\n      border-radius: 3px;\n      color: blueprint-text;\n      text-decoration: none;\n      font-size: 13px;\n      transition: all 0.2s;\n      cursor: pointer;\n\n      &:hover {\n        background: rgba(30, 58, 95, 0.6);\n        border-left-color: blueprint-accent;\n        color: primary-text;\n        transform: translateX(4px);\n      }\n\n      &.active {\n        background: rgba(58, 123, 213, 0.2);\n        border-left-color: blueprint-bright;\n        color: blueprint-bright;\n        font-weight: 600;\n        box-shadow: 0 0 10px rgba(58, 123, 213, 0.3);\n      }\n    }\n  }\n}\n\n.controls {\n  padding: 16px;\n  margin-top: 8px;\n  border-top: 2px solid blueprint-border;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n\n  a.album-button,\n  a.randomize-button,\n  a.stop-button,\n  a.save-button {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    padding: 14px 24px;\n    background: transparent;\n    text-decoration: none;\n    border: 2px solid;\n    border-radius: 4px;\n    font-size: 15px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n    &:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 0 20px currentColor;\n    }\n\n    &:active {\n      transform: translateY(0);\n      box-shadow: 0 0 10px currentColor;\n    }\n  }\n\n  a.album-button {\n    color: #b884d4;\n    border-color: #b884d4;\n\n    &:hover {\n      color: #d4a5f0;\n      border-color: #d4a5f0;\n    }\n  }\n\n  a.randomize-button {\n    color: blueprint-bright;\n    border-color: blueprint-bright;\n\n    &:hover {\n      color: primary-text;\n      border-color: primary-text;\n    }\n  }\n\n  a.stop-button {\n    color: #ef5350;\n    border-color: #ef5350;\n\n    &:hover {\n      color: #ff6b68;\n      border-color: #ff6b68;\n    }\n  }\n\n  a.save-button {\n    color: #26a69a;\n    border-color: #26a69a;\n\n    &:hover {\n      color: #4db6ac;\n      border-color: #4db6ac;\n    }\n  }\n}\n\n// Light theme overrides\n#app.light-theme {\n  .sidebar-toggle,\n  .theme-toggle {\n    background: light-bg;\n    border-color: light-accent;\n    color: light-bright;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1),\n                0 0 20px rgba(37, 99, 235, 0.1),\n                inset 0 1px 0 rgba(255, 255, 255, 0.5);\n\n    &:hover {\n      background: light-dark;\n      border-color: light-bright;\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15),\n                  0 0 30px rgba(37, 99, 235, 0.2),\n                  inset 0 1px 0 rgba(255, 255, 255, 0.6);\n    }\n  }\n\n  .sidebar {\n    background: light-bg;\n    border-right-color: light-accent;\n    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1),\n                0 0 40px rgba(37, 99, 235, 0.08);\n\n    background-image:\n      linear-gradient(light-grid 1px, transparent 1px),\n      linear-gradient(90deg, light-grid 1px, transparent 1px);\n  }\n\n  .editor-container {\n    background: linear-gradient(to bottom, light-dark 0%, light-bg 100%);\n\n    a {\n      color: light-bright;\n      border-bottom-color: light-border;\n\n      &:hover {\n        color: light-primary-text;\n        border-bottom-color: light-accent;\n      }\n    }\n\n    &::-webkit-scrollbar-track {\n      background: light-dark;\n      border-left-color: light-border;\n    }\n\n    &::-webkit-scrollbar-thumb {\n      background: light-accent;\n\n      &:hover {\n        background: light-bright;\n      }\n    }\n  }\n\n  .title {\n    color: light-primary-text;\n    border-bottom-color: light-border;\n\n    a {\n      color: light-help-text-color;\n      border-color: light-border;\n      background: light-dark;\n\n      &:hover {\n        background: light-border;\n        border-color: light-accent;\n      }\n    }\n\n    a.syntax-visible {\n      background: light-accent;\n      color: white;\n      border-color: light-bright;\n    }\n\n    .github-link {\n      color: light-bright;\n      border: none;\n      background: transparent;\n\n      &:hover {\n        color: light-primary-text;\n      }\n    }\n  }\n\n  .help {\n    background: light-help-background;\n    color: light-text;\n    border-color: light-border;\n\n    a {\n      border-bottom-color: light-border;\n      color: light-primary-text;\n    }\n\n    ul {\n      strong {\n        color: light-bright;\n      }\n\n      code {\n        color: #059669;\n        background: rgba(0, 0, 0, 0.05);\n      }\n    }\n\n    pre {\n      background: rgba(0, 0, 0, 0.05);\n      border-color: light-border;\n    }\n  }\n\n  .syntax-help-button {\n    color: light-help-text-color;\n    border-color: light-border;\n    background: light-dark;\n\n    &:hover {\n      background: light-border;\n      border-color: light-accent;\n    }\n\n    &.syntax-visible {\n      background: light-accent;\n      color: white;\n      border-color: light-bright;\n    }\n  }\n\n  .examples-section {\n    border-top-color: light-border;\n\n    .examples-list {\n      &::-webkit-scrollbar-track {\n        background: light-dark;\n      }\n\n      &::-webkit-scrollbar-thumb {\n        background: light-accent;\n\n        &:hover {\n          background: light-bright;\n        }\n      }\n\n      .example-item {\n        background: rgba(185, 201, 219, 0.2);\n        border-color: light-border;\n        border-left-color: light-border;\n        color: light-text;\n\n        &:hover {\n          background: rgba(185, 201, 219, 0.4);\n          border-left-color: light-accent;\n          color: light-primary-text;\n        }\n\n        &.active {\n          background: rgba(37, 99, 235, 0.15);\n          border-left-color: light-bright;\n          color: light-bright;\n          box-shadow: 0 0 10px rgba(37, 99, 235, 0.2);\n        }\n      }\n    }\n  }\n\n  .controls {\n    border-top-color: light-border;\n\n    a.album-button {\n      color: #7c3aed;\n      border-color: #7c3aed;\n\n      &:hover {\n        color: #6d28d9;\n        border-color: #6d28d9;\n      }\n    }\n\n    a.randomize-button {\n      color: light-bright;\n      border-color: light-bright;\n\n      &:hover {\n        color: light-accent;\n        border-color: light-accent;\n      }\n    }\n\n    a.stop-button {\n      color: #dc2626;\n      border-color: #dc2626;\n\n      &:hover {\n        color: #b91c1c;\n        border-color: #b91c1c;\n      }\n    }\n\n    a.save-button {\n      color: #0d9488;\n      border-color: #0d9488;\n\n      &:hover {\n        color: #0f766e;\n        border-color: #0f766e;\n      }\n    }\n  }\n\n  .error-container {\n    background: #fca5a5;\n    color: #7f1d1d;\n    border-left-color: #dc2626;\n  }\n\n  .line-width-control {\n    background: rgba(185, 201, 219, 0.2);\n    border-color: light-border;\n\n    label {\n      color: light-text;\n    }\n\n    input[type='range'] {\n      background: light-border;\n\n      &::-webkit-slider-thumb {\n        background: light-bright;\n        border-color: light-bg;\n        box-shadow: 0 0 10px rgba(29, 78, 216, 0.3);\n\n        &:hover {\n          background: light-accent;\n          box-shadow: 0 0 15px rgba(29, 78, 216, 0.5);\n        }\n      }\n\n      &::-moz-range-thumb {\n        background: light-bright;\n        border-color: light-bg;\n        box-shadow: 0 0 10px rgba(29, 78, 216, 0.3);\n\n        &:hover {\n          background: light-accent;\n          box-shadow: 0 0 15px rgba(29, 78, 216, 0.5);\n        }\n      }\n    }\n\n    .width-value {\n      color: light-bright;\n    }\n  }\n\n  .view-controls {\n    background: rgba(185, 201, 219, 0.2);\n    border-color: light-border;\n\n    .grid-toggle {\n      label {\n        color: light-text;\n      }\n\n      .toggle-switch {\n        background: light-border;\n        border-color: light-border;\n\n        &::after {\n          background: light-text;\n        }\n\n        &.active {\n          background: light-accent;\n          border-color: light-bright;\n\n          &::after {\n            background: light-bright;\n            box-shadow: 0 2px 8px rgba(29, 78, 216, 0.4);\n          }\n        }\n\n        &:hover {\n          border-color: light-accent;\n        }\n      }\n    }\n\n    .rotation-control {\n      label {\n        color: light-text;\n      }\n\n      input[type='range'] {\n        background: light-border;\n\n        &::-webkit-slider-thumb {\n          background: light-bright;\n          border-color: light-bg;\n          box-shadow: 0 0 10px rgba(29, 78, 216, 0.3);\n\n          &:hover {\n            background: light-accent;\n            box-shadow: 0 0 15px rgba(29, 78, 216, 0.5);\n          }\n        }\n\n        &::-moz-range-thumb {\n          background: light-bright;\n          border-color: light-bg;\n          box-shadow: 0 0 10px rgba(29, 78, 216, 0.3);\n\n          &:hover {\n            background: light-accent;\n            box-shadow: 0 0 15px rgba(29, 78, 216, 0.5);\n          }\n        }\n      }\n\n      .rotation-value {\n        color: light-bright;\n      }\n    }\n  }\n\n  .modal-overlay {\n    background: rgba(0, 0, 0, 0.5);\n  }\n\n  .modal-content {\n    background: light-bg;\n    border-color: light-accent;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),\n                0 0 40px rgba(37, 99, 235, 0.2);\n\n    h3 {\n      color: light-bright;\n    }\n\n    p {\n      color: light-text;\n    }\n  }\n\n  .modal-btn {\n    color: light-bright;\n\n    &.light-btn {\n      border-color: #f59e0b;\n      color: #f59e0b;\n\n      &:hover {\n        background: rgba(245, 158, 11, 0.1);\n      }\n    }\n\n    &.dark-btn {\n      border-color: #7c3aed;\n      color: #7c3aed;\n\n      &:hover {\n        background: rgba(124, 58, 237, 0.1);\n      }\n    }\n\n    &.both-btn {\n      border-color: light-bright;\n      color: light-bright;\n\n      &:hover {\n        background: rgba(29, 78, 216, 0.1);\n      }\n    }\n  }\n\n  .modal-cancel {\n    border-color: light-border;\n    color: light-text;\n\n    &:hover {\n      background: light-border;\n      color: light-primary-text;\n    }\n  }\n}\n\n// Modal styles\n.modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.85);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10000;\n  backdrop-filter: blur(4px);\n}\n\n.modal-content {\n  background: blueprint-bg;\n  border: 2px solid blueprint-accent;\n  border-radius: 8px;\n  padding: 32px;\n  max-width: 500px;\n  width: 90%;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),\n              0 0 40px rgba(58, 123, 213, 0.3);\n\n  h3 {\n    color: blueprint-bright;\n    font-size: 24px;\n    margin: 0 0 12px 0;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n    font-family: 'Courier New', monospace;\n  }\n\n  p {\n    color: blueprint-text;\n    margin: 0 0 24px 0;\n    font-size: 15px;\n  }\n}\n\n.modal-buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.modal-btn {\n  padding: 16px 20px;\n  border: 2px solid;\n  border-radius: 6px;\n  background: transparent;\n  color: blueprint-bright;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  text-align: left;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n\n  .filename {\n    font-size: 12px;\n    opacity: 0.7;\n    font-weight: 400;\n    font-family: 'Courier New', monospace;\n  }\n\n  &:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 0 20px currentColor;\n  }\n\n  &.light-btn {\n    border-color: #fbbf24;\n    color: #fbbf24;\n\n    &:hover {\n      background: rgba(251, 191, 36, 0.1);\n    }\n  }\n\n  &.dark-btn {\n    border-color: #8b5cf6;\n    color: #8b5cf6;\n\n    &:hover {\n      background: rgba(139, 92, 246, 0.1);\n    }\n  }\n\n  &.both-btn {\n    border-color: blueprint-bright;\n    color: blueprint-bright;\n\n    &:hover {\n      background: rgba(110, 181, 255, 0.1);\n    }\n  }\n}\n\n.modal-cancel {\n  width: 100%;\n  padding: 12px;\n  background: transparent;\n  border: 2px solid blueprint-border;\n  border-radius: 6px;\n  color: blueprint-text;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n\n  &:hover {\n    background: blueprint-border;\n    color: primary-text;\n  }\n}\n\n\n@media (max-width: 768px) {\n  .sidebar {\n    width: 100%;\n    max-width: 400px;\n  }\n\n  .sidebar-toggle.sidebar-open {\n    left: calc(100% - 60px);\n    max-left: 416px;\n  }\n}\n\n// Selection mask styles\n.selection-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 10001;\n  backdrop-filter: blur(2px);\n}\n\n.selection-mask {\n  position: absolute;\n  cursor: move;\n  user-select: none;\n\n  .selection-border {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border: 3px dashed blueprint-bright;\n    background: rgba(110, 181, 255, 0.1);\n    pointer-events: none;\n    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5),\n                0 0 30px rgba(110, 181, 255, 0.5);\n  }\n\n  .resize-handle {\n    position: absolute;\n    background: blueprint-bright;\n    border: 2px solid blueprint-bg;\n    box-shadow: 0 0 10px rgba(110, 181, 255, 0.8);\n    z-index: 10;\n\n    &.nw, &.ne, &.sw, &.se {\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n    }\n\n    &.n, &.s, &.e, &.w {\n      background: blueprint-accent;\n    }\n\n    &.nw {\n      top: -6px;\n      left: -6px;\n      cursor: nw-resize;\n    }\n\n    &.ne {\n      top: -6px;\n      right: -6px;\n      cursor: ne-resize;\n    }\n\n    &.sw {\n      bottom: -6px;\n      left: -6px;\n      cursor: sw-resize;\n    }\n\n    &.se {\n      bottom: -6px;\n      right: -6px;\n      cursor: se-resize;\n    }\n\n    &.n {\n      top: -4px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 40px;\n      height: 8px;\n      border-radius: 4px;\n      cursor: n-resize;\n    }\n\n    &.s {\n      bottom: -4px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 40px;\n      height: 8px;\n      border-radius: 4px;\n      cursor: s-resize;\n    }\n\n    &.w {\n      left: -4px;\n      top: 50%;\n      transform: translateY(-50%);\n      width: 8px;\n      height: 40px;\n      border-radius: 4px;\n      cursor: w-resize;\n    }\n\n    &.e {\n      right: -4px;\n      top: 50%;\n      transform: translateY(-50%);\n      width: 8px;\n      height: 40px;\n      border-radius: 4px;\n      cursor: e-resize;\n    }\n\n    &:hover {\n      background: primary-text;\n      transform: scale(1.2);\n      box-shadow: 0 0 20px rgba(110, 181, 255, 1);\n    }\n\n    &.n:hover, &.s:hover {\n      transform: translateX(-50%) scale(1.2);\n    }\n\n    &.w:hover, &.e:hover {\n      transform: translateY(-50%) scale(1.2);\n    }\n  }\n}\n\n.selection-controls {\n  position: fixed;\n  bottom: 40px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 16px;\n  z-index: 10002;\n\n  button {\n    padding: 14px 32px;\n    border: 2px solid;\n    border-radius: 6px;\n    font-size: 16px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n\n    &:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 0 30px currentColor;\n    }\n  }\n\n  .selection-confirm-btn {\n    background: blueprint-accent;\n    color: white;\n    border-color: blueprint-bright;\n\n    &:hover {\n      background: blueprint-bright;\n      border-color: primary-text;\n    }\n  }\n\n  .selection-cancel-btn {\n    background: transparent;\n    color: #ef5350;\n    border-color: #ef5350;\n\n    &:hover {\n      background: rgba(239, 83, 80, 0.1);\n      color: #ff6b68;\n      border-color: #ff6b68;\n    }\n  }\n}\n\n// Light theme overrides for selection mask\n#app.light-theme {\n  .selection-mask {\n    .selection-border {\n      border-color: light-bright;\n      background: rgba(29, 78, 216, 0.1);\n      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5),\n                  0 0 30px rgba(29, 78, 216, 0.5);\n    }\n\n    .resize-handle {\n      background: light-bright;\n      border-color: light-bg;\n      box-shadow: 0 0 10px rgba(29, 78, 216, 0.8);\n\n      &.n, &.s, &.e, &.w {\n        background: light-accent;\n      }\n\n      &:hover {\n        background: light-primary-text;\n      }\n    }\n  }\n\n  .selection-controls {\n    .selection-confirm-btn {\n      background: light-accent;\n      border-color: light-bright;\n\n      &:hover {\n        background: light-bright;\n      }\n    }\n\n    .selection-cancel-btn {\n      color: #dc2626;\n      border-color: #dc2626;\n\n      &:hover {\n        background: rgba(220, 38, 38, 0.1);\n        color: #b91c1c;\n        border-color: #b91c1c;\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=13121ccb\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\nimport style0 from \"./App.vue?vue&type=style&index=0&id=13121ccb&prod&lang=stylus\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _vm._m(0)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"absolute no-webgl\"},[_c('h3',[_vm._v(\"WebGL is not enabled :(\")]),_c('p',[_vm._v(\" To render large amount of data fast, this website uses \"),_c('a',{attrs:{\"href\":\"https://get.webgl.org/\"}},[_vm._v(\"WebGL\")]),_vm._v(\", which seem to be not supported by the device that you are using. \")]),_c('p',[_vm._v(\"Please try a different device to play with this website\")])])\n}]\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./NoWebGL.vue?vue&type=template&id=283309e6&scoped=true\"\nvar script = {}\nimport style0 from \"./NoWebGL.vue?vue&type=style&index=0&id=283309e6&prod&lang=stylus&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"283309e6\",\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport App from './App.vue'\nimport NoWebGL from './NoWebGL';\nimport {isWebGLEnabled} from 'w-gl';\n\nVue.config.productionTip = false\n\nlet canRender = isWebGLEnabled(document.querySelector('#canvas'));\n\nnew Vue({\n  render: h => h(canRender ? App : NoWebGL),\n}).$mount('#app')\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./NoWebGL.vue?vue&type=style&index=0&id=283309e6&prod&lang=stylus&scoped=true\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=13121ccb&prod&lang=stylus\"","/* eslint-disable */\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n// Hacked together to barely support l-system definition\n// by Andrei Kashcha (anvaka@)\n\nmodule.exports = function(CodeMirror) {\n\"use strict\";\n\nCodeMirror.defineMode(\"javascript\", function(config, parserConfig) {\n  var indentUnit = config.indentUnit;\n  var statementIndent = parserConfig.statementIndent;\n  var jsonMode = parserConfig.json;\n  var lSystemMode = parserConfig.lsystem;\n  var isTS = parserConfig.typescript;\n  var wordRE = parserConfig.wordCharacters || /[\\w$\\xa1-\\uffff]/;\n  var ruleCharRE = /[a-zA-Z+_^?~<>|&*%\\][-]/;\n\n  // Tokenizer\n\n  var keywords = function(){\n    function kw(type) {return {type: type, style: \"keyword\"};}\n    var A = kw(\"keyword a\"), B = kw(\"keyword b\"), C = kw(\"keyword c\"), D = kw(\"keyword d\");\n    var operator = kw(\"operator\"), atom = {type: \"atom\", style: \"atom\"};\n\n    return {\n      axiom: kw('axiom'),\n      angle: kw('angle'),\n      start: kw('start'),\n      direction: kw('direction'),\n      position: kw('position'),\n      rules: kw('rules'),\n      depth: kw('depth'),\n      stepsPerFrame: kw('stepsPerFrame'),\n      actions: kw('actions'),\n      color: kw('color'),\n      width: kw('width'),\n    };\n  }();\n  let nope = {test: () => false}\n\n  var isOperatorChar = nope; \n\n  function readRegexp(stream) {\n    var escaped = false, next, inSet = false;\n    while ((next = stream.next()) != null) {\n      if (!escaped) {\n        if (next == \"/\" && !inSet) return;\n        if (next == \"[\") inSet = true;\n        else if (inSet && next == \"]\") inSet = false;\n      }\n      escaped = !escaped && next == \"\\\\\";\n    }\n  }\n\n  // Used as scratch variables to communicate multiple values without\n  // consing up tons of objects.\n  var type, content;\n  function ret(tp, style, cont) {\n    type = tp; content = cont;\n    return style;\n  }\n  function tokenBase(stream, state) {\n    var ch = stream.next();\n    if (ch == '\"' || ch == \"'\") {\n      state.tokenize = tokenString(ch);\n      return state.tokenize(stream, state);\n    } else if (ch == \".\" && stream.match(/^\\d[\\d_]*(?:[eE][+\\-]?[\\d_]+)?/)) {\n      return ret(\"number\", \"number\");\n    } else if (ch == \".\" && stream.match(\"..\")) {\n      return ret(\"spread\", \"meta\");\n    } else if (/[{}\\(\\),;\\:\\.]/.test(ch)) {\n      return ret(ch);\n    } else if (ch == \"=\" && stream.eat(\">\")) {\n      return ret(\"=>\", \"operator\");\n    } else if (ch == \"0\" && stream.match(/^(?:x[\\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/)) {\n      return ret(\"number\", \"number\");\n    } else if (/\\d/.test(ch)) {\n      stream.match(/^[\\d_]*(?:n|(?:\\.[\\d_]*)?(?:[eE][+\\-]?[\\d_]+)?)?/);\n      return ret(\"number\", \"number\");\n    } else if (ch == \"/\") {\n      if (stream.eat(\"*\")) {\n        state.tokenize = tokenComment;\n        return tokenComment(stream, state);\n      } else if (stream.eat(\"/\")) {\n        stream.skipToEnd();\n        return ret(\"comment\", \"comment\");\n      } else if (expressionAllowed(stream, state, 1)) {\n        readRegexp(stream);\n        stream.match(/^\\b(([gimyus])(?![gimyus]*\\2))+\\b/);\n        return ret(\"regexp\", \"string-2\");\n      } else {\n        stream.eat(\"=\");\n        return ret(\"operator\", \"operator\", stream.current());\n      }\n    } else if (ch == \"`\") {\n      state.tokenize = tokenQuasi;\n      return tokenQuasi(stream, state);\n    } else if (ch == \"#\" && stream.peek() == \"!\") {\n      stream.skipToEnd();\n      return ret(\"meta\", \"meta\");\n    } else if (ch == \"#\" && stream.eatWhile(wordRE)) {\n      return ret(\"variable\", \"property\")\n    } else if (ch == \"<\" && stream.match(\"!--\") || ch == \"-\" && stream.match(\"->\")) {\n      stream.skipToEnd()\n      return ret(\"comment\", \"comment\")\n    } else if (isOperatorChar.test(ch)) {\n      if (ch != \">\" || !state.lexical || state.lexical.type != \">\") {\n        if (stream.eat(\"=\")) {\n          if (ch == \"!\" || ch == \"=\") stream.eat(\"=\")\n        } else if (/[<>*+\\-]/.test(ch)) {\n          stream.eat(ch)\n          if (ch == \">\") stream.eat(ch)\n        }\n      }\n      if (ch == \"?\" && stream.eat(\".\")) return ret(\".\")\n      return ret(\"operator\", \"operator\", stream.current());\n    } else if (wordRE.test(ch)) {\n      stream.eatWhile(wordRE);\n      var word = stream.current()\n      if (state.lastType != \".\") {\n        if (keywords.propertyIsEnumerable(word)) {\n          var kw = keywords[word]\n          return ret(kw.type, kw.style, word)\n        }\n        if (word == \"async\" && stream.match(/^(\\s|\\/\\*.*?\\*\\/)*[\\[\\(\\w]/, false))\n          return ret(\"async\", \"keyword\", word)\n      }\n      return ret(\"variable\", \"variable\", word)\n    } else if (ruleCharRE.test(ch)) {\n      var arrow = stream.string.indexOf(\"=>\", stream.start);\n      if (arrow > -1) {\n        var word = stream.current()\n        return ret(\"def\", \"def\", word)\n      }\n    } \n  }\n\n  function tokenString(quote) {\n    return function(stream, state) {\n      var escaped = false, next;\n      while ((next = stream.next()) != null) {\n        if (next == quote && !escaped) break;\n        escaped = !escaped && next == \"\\\\\";\n      }\n      if (!escaped) state.tokenize = tokenBase;\n      return ret(\"string\", \"string\");\n    };\n  }\n\n  function tokenComment(stream, state) {\n    var maybeEnd = false, ch;\n    while (ch = stream.next()) {\n      if (ch == \"/\" && maybeEnd) {\n        state.tokenize = tokenBase;\n        break;\n      }\n      maybeEnd = (ch == \"*\");\n    }\n    return ret(\"comment\", \"comment\");\n  }\n\n  function tokenQuasi(stream, state) {\n    var escaped = false, next;\n    while ((next = stream.next()) != null) {\n      if (!escaped && (next == \"`\" || next == \"$\" && stream.eat(\"{\"))) {\n        state.tokenize = tokenBase;\n        break;\n      }\n      escaped = !escaped && next == \"\\\\\";\n    }\n    return ret(\"quasi\", \"string-2\", stream.current());\n  }\n\n  var brackets = \"([{}])\";\n  // This is a crude lookahead trick to try and notice that we're\n  // parsing the argument patterns for a fat-arrow function before we\n  // actually hit the arrow token. It only works if the arrow is on\n  // the same line as the arguments and there's no strange noise\n  // (comments) in between. Fallback is to only notice when we hit the\n  // arrow, and not declare the arguments as locals for the arrow\n  // body.\n  function findFatArrow(stream, state) {\n    if (state.fatArrowAt) state.fatArrowAt = null;\n    var arrow = stream.string.indexOf(\"=>\", stream.start);\n    if (arrow < 0) return;\n\n    if (isTS) { // Try to skip TypeScript return type declarations after the arguments\n      var m = /:\\s*(?:\\w+(?:<[^>]*>|\\[\\])?|\\{[^}]*\\})\\s*$/.exec(stream.string.slice(stream.start, arrow))\n      if (m) arrow = m.index\n    }\n\n    var depth = 0, sawSomething = false;\n    for (var pos = arrow - 1; pos >= 0; --pos) {\n      var ch = stream.string.charAt(pos);\n      var bracket = brackets.indexOf(ch);\n      if (bracket >= 0 && bracket < 3) {\n        if (!depth) { ++pos; break; }\n        if (--depth == 0) { if (ch == \"(\") sawSomething = true; break; }\n      } else if (bracket >= 3 && bracket < 6) {\n        ++depth;\n      } else if (wordRE.test(ch)) {\n        sawSomething = true;\n      } else if (/[\"'\\/`]/.test(ch)) {\n        for (;; --pos) {\n          if (pos == 0) return\n          var next = stream.string.charAt(pos - 1)\n          if (next == ch && stream.string.charAt(pos - 2) != \"\\\\\") { pos--; break }\n        }\n      } else if (sawSomething && !depth) {\n        ++pos;\n        break;\n      }\n    }\n    if (sawSomething && !depth) state.fatArrowAt = pos;\n  }\n\n  // Parser\n\n  var atomicTypes = {\"atom\": true, \"number\": true, \"variable\": true, \"string\": true, \"regexp\": true, \"this\": true, \"jsonld-keyword\": true};\n\n  function JSLexical(indented, column, type, align, prev, info) {\n    this.indented = indented;\n    this.column = column;\n    this.type = type;\n    this.prev = prev;\n    this.info = info;\n    if (align != null) this.align = align;\n  }\n\n  function inScope(state, varname) {\n    for (var v = state.localVars; v; v = v.next)\n      if (v.name == varname) return true;\n    for (var cx = state.context; cx; cx = cx.prev) {\n      for (var v = cx.vars; v; v = v.next)\n        if (v.name == varname) return true;\n    }\n  }\n\n  function parseJS(state, style, type, content, stream) {\n    var cc = state.cc;\n    // Communicate our context to the combinators.\n    // (Less wasteful than consing up a hundred closures on every call.)\n    cx.state = state; cx.stream = stream; cx.marked = null, cx.cc = cc; cx.style = style;\n\n    if (!state.lexical.hasOwnProperty(\"align\"))\n      state.lexical.align = true;\n\n    while(true) {\n      var combinator = cc.length ? cc.pop() : jsonMode ? expression : statement;\n      if (combinator(type, content)) {\n        while(cc.length && cc[cc.length - 1].lex)\n          cc.pop()();\n        if (cx.marked) return cx.marked;\n        if (type == \"variable\" && inScope(state, content)) return \"variable-2\";\n        return style;\n      }\n    }\n  }\n\n  // Combinator utils\n\n  var cx = {state: null, column: null, marked: null, cc: null};\n  function pass() {\n    for (var i = arguments.length - 1; i >= 0; i--) cx.cc.push(arguments[i]);\n  }\n  function cont() {\n    pass.apply(null, arguments);\n    return true;\n  }\n  function inList(name, list) {\n    for (var v = list; v; v = v.next) if (v.name == name) return true\n    return false;\n  }\n  function register(varname) {\n    var state = cx.state;\n    cx.marked = \"def\";\n    if (state.context) {\n      if (state.lexical.info == \"var\" && state.context && state.context.block) {\n        // FIXME function decls are also not block scoped\n        var newContext = registerVarScoped(varname, state.context)\n        if (newContext != null) {\n          state.context = newContext\n          return\n        }\n      } else if (!inList(varname, state.localVars)) {\n        state.localVars = new Var(varname, state.localVars)\n        return\n      }\n    }\n    // Fall through means this is global\n    if (parserConfig.globalVars && !inList(varname, state.globalVars))\n      state.globalVars = new Var(varname, state.globalVars)\n  }\n  function registerVarScoped(varname, context) {\n    if (!context) {\n      return null\n    } else if (context.block) {\n      var inner = registerVarScoped(varname, context.prev)\n      if (!inner) return null\n      if (inner == context.prev) return context\n      return new Context(inner, context.vars, true)\n    } else if (inList(varname, context.vars)) {\n      return context\n    } else {\n      return new Context(context.prev, new Var(varname, context.vars), false)\n    }\n  }\n\n  function isModifier(name) {\n    return name == \"public\" || name == \"private\" || name == \"protected\" || name == \"abstract\" || name == \"readonly\"\n  }\n\n  // Combinators\n\n  function Context(prev, vars, block) { this.prev = prev; this.vars = vars; this.block = block }\n  function Var(name, next) { this.name = name; this.next = next }\n\n  var defaultVars = new Var(\"this\", new Var(\"arguments\", null))\n  function pushcontext() {\n    cx.state.context = new Context(cx.state.context, cx.state.localVars, false)\n    cx.state.localVars = defaultVars\n  }\n  function pushblockcontext() {\n    cx.state.context = new Context(cx.state.context, cx.state.localVars, true)\n    cx.state.localVars = null\n  }\n  function popcontext() {\n    cx.state.localVars = cx.state.context.vars\n    cx.state.context = cx.state.context.prev\n  }\n  popcontext.lex = true\n  function pushlex(type, info) {\n    var result = function() {\n      var state = cx.state, indent = state.indented;\n      if (state.lexical.type == \"stat\") indent = state.lexical.indented;\n      else for (var outer = state.lexical; outer && outer.type == \")\" && outer.align; outer = outer.prev)\n        indent = outer.indented;\n      state.lexical = new JSLexical(indent, cx.stream.column(), type, null, state.lexical, info);\n    };\n    result.lex = true;\n    return result;\n  }\n  function poplex() {\n    var state = cx.state;\n    if (state.lexical.prev) {\n      if (state.lexical.type == \")\")\n        state.indented = state.lexical.indented;\n      state.lexical = state.lexical.prev;\n    }\n  }\n  poplex.lex = true;\n\n  function expect(wanted) {\n    function exp(type) {\n      if (type == wanted) return cont();\n      else if (wanted == \";\" || type == \"}\" || type == \")\" || type == \"]\") return pass();\n      else return cont(exp);\n    };\n    return exp;\n  }\n\n  function statement(type, value) {\n    if (type == \"var\") return cont(pushlex(\"vardef\", value), vardef, expect(\";\"), poplex);\n    if (type == \"keyword a\") return cont(pushlex(\"form\"), parenExpr, statement, poplex);\n    if (type == \"keyword b\") return cont(pushlex(\"form\"), statement, poplex);\n    if (type == \"keyword d\") return cx.stream.match(/^\\s*$/, false) ? cont() : cont(pushlex(\"stat\"), maybeexpression, expect(\";\"), poplex);\n    if (type == \"debugger\") return cont(expect(\";\"));\n    if (type == \"{\") return cont(pushlex(\"}\"), pushblockcontext, block, poplex, popcontext);\n    if (type == \";\") return cont();\n    if (type == \"if\") {\n      if (cx.state.lexical.info == \"else\" && cx.state.cc[cx.state.cc.length - 1] == poplex)\n        cx.state.cc.pop()();\n      return cont(pushlex(\"form\"), parenExpr, statement, poplex, maybeelse);\n    }\n    if (type == \"function\") return cont(functiondef);\n    if (type == \"for\") return cont(pushlex(\"form\"), forspec, statement, poplex);\n    if (type == \"class\" || (isTS && value == \"interface\")) {\n      cx.marked = \"keyword\"\n      return cont(pushlex(\"form\", type == \"class\" ? type : value), className, poplex)\n    }\n    if (type == \"variable\") {\n      if (isTS && value == \"declare\") {\n        cx.marked = \"keyword\"\n        return cont(statement)\n      } else if (isTS && (value == \"module\" || value == \"enum\" || value == \"type\") && cx.stream.match(/^\\s*\\w/, false)) {\n        cx.marked = \"keyword\"\n        if (value == \"enum\") return cont(enumdef);\n        else if (value == \"type\") return cont(typename, expect(\"operator\"), typeexpr, expect(\";\"));\n        else return cont(pushlex(\"form\"), pattern, expect(\"{\"), pushlex(\"}\"), block, poplex, poplex)\n      } else if (isTS && value == \"namespace\") {\n        cx.marked = \"keyword\"\n        return cont(pushlex(\"form\"), expression, statement, poplex)\n      } else if (isTS && value == \"abstract\") {\n        cx.marked = \"keyword\"\n        return cont(statement)\n      } else {\n        return cont(pushlex(\"stat\"), maybelabel);\n      }\n    }\n    if (type == \"switch\") return cont(pushlex(\"form\"), parenExpr, expect(\"{\"), pushlex(\"}\", \"switch\"), pushblockcontext,\n                                      block, poplex, poplex, popcontext);\n    if (type == \"case\") return cont(expression, expect(\":\"));\n    if (type == \"default\") return cont(expect(\":\"));\n    if (type == \"catch\") return cont(pushlex(\"form\"), pushcontext, maybeCatchBinding, statement, poplex, popcontext);\n    if (type == \"export\") return cont(pushlex(\"stat\"), afterExport, poplex);\n    if (type == \"import\") return cont(pushlex(\"stat\"), afterImport, poplex);\n    if (type == \"async\") return cont(statement)\n    if (value == \"@\") return cont(expression, statement)\n    return pass(pushlex(\"stat\"), expression, expect(\";\"), poplex);\n  }\n  function maybeCatchBinding(type) {\n    if (type == \"(\") return cont(funarg, expect(\")\"))\n  }\n  function expression(type, value) {\n    return expressionInner(type, value, false);\n  }\n  function expressionNoComma(type, value) {\n    return expressionInner(type, value, true);\n  }\n  function parenExpr(type) {\n    if (type != \"(\") return pass()\n    return cont(pushlex(\")\"), maybeexpression, expect(\")\"), poplex)\n  }\n  function expressionInner(type, value, noComma) {\n    if (cx.state.fatArrowAt == cx.stream.start) {\n      var body = noComma ? arrowBodyNoComma : arrowBody;\n      if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, expect(\"=>\"), body, popcontext);\n      else if (type == \"variable\") return pass(pushcontext, pattern, expect(\"=>\"), body, popcontext);\n    }\n\n    var maybeop = noComma ? maybeoperatorNoComma : maybeoperatorComma;\n    if (atomicTypes.hasOwnProperty(type)) return cont(maybeop);\n    if (type == \"function\") return cont(functiondef, maybeop);\n    if (type == \"class\" || (isTS && value == \"interface\")) { cx.marked = \"keyword\"; return cont(pushlex(\"form\"), classExpression, poplex); }\n    if (type == \"keyword c\" || type == \"async\") return cont(noComma ? expressionNoComma : expression);\n    if (type == \"(\") return cont(pushlex(\")\"), maybeexpression, expect(\")\"), poplex, maybeop);\n    if (type == \"operator\" || type == \"spread\") return cont(noComma ? expressionNoComma : expression);\n    if (type == \"[\") return cont(pushlex(\"]\"), arrayLiteral, poplex, maybeop);\n    if (type == \"{\") return contCommasep(objprop, \"}\", null, maybeop);\n    if (type == \"quasi\") return pass(quasi, maybeop);\n    if (type == \"new\") return cont(maybeTarget(noComma));\n    if (type == \"import\") return cont(expression);\n    return cont();\n  }\n  function maybeexpression(type) {\n    if (type.match(/[;\\}\\)\\],]/)) return pass();\n    return pass(expression);\n  }\n\n  function maybeoperatorComma(type, value) {\n    if (type == \",\") return cont(maybeexpression);\n    return maybeoperatorNoComma(type, value, false);\n  }\n  function maybeoperatorNoComma(type, value, noComma) {\n    var me = noComma == false ? maybeoperatorComma : maybeoperatorNoComma;\n    var expr = noComma == false ? expression : expressionNoComma;\n    if (type == \"=>\") return cont(pushcontext, noComma ? arrowBodyNoComma : arrowBody, popcontext);\n    if (type == \"operator\") {\n      if (/\\+\\+|--/.test(value) || isTS && value == \"!\") return cont(me);\n      if (isTS && value == \"<\" && cx.stream.match(/^([^<>]|<[^<>]*>)*>\\s*\\(/, false))\n        return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, me);\n      if (value == \"?\") return cont(expression, expect(\":\"), expr);\n      return cont(expr);\n    }\n    if (type == \"quasi\") { return pass(quasi, me); }\n    if (type == \";\") return;\n    if (type == \"(\") return contCommasep(expressionNoComma, \")\", \"call\", me);\n    if (type == \".\") return cont(property, me);\n    if (type == \"[\") return cont(pushlex(\"]\"), maybeexpression, expect(\"]\"), poplex, me);\n    if (isTS && value == \"as\") { cx.marked = \"keyword\"; return cont(typeexpr, me) }\n    if (type == \"regexp\") {\n      cx.state.lastType = cx.marked = \"operator\"\n      cx.stream.backUp(cx.stream.pos - cx.stream.start - 1)\n      return cont(expr)\n    }\n  }\n  function quasi(type, value) {\n    if (type != \"quasi\") return pass();\n    if (value.slice(value.length - 2) != \"${\") return cont(quasi);\n    return cont(expression, continueQuasi);\n  }\n  function continueQuasi(type) {\n    if (type == \"}\") {\n      cx.marked = \"string-2\";\n      cx.state.tokenize = tokenQuasi;\n      return cont(quasi);\n    }\n  }\n  function arrowBody(type) {\n    findFatArrow(cx.stream, cx.state);\n    return pass(type == \"{\" ? statement : expression);\n  }\n  function arrowBodyNoComma(type) {\n    findFatArrow(cx.stream, cx.state);\n    return pass(type == \"{\" ? statement : expressionNoComma);\n  }\n  function maybeTarget(noComma) {\n    return function(type) {\n      if (type == \".\") return cont(noComma ? targetNoComma : target);\n      else if (type == \"variable\" && isTS) return cont(maybeTypeArgs, noComma ? maybeoperatorNoComma : maybeoperatorComma)\n      else return pass(noComma ? expressionNoComma : expression);\n    };\n  }\n  function target(_, value) {\n    if (value == \"target\") { cx.marked = \"keyword\"; return cont(maybeoperatorComma); }\n  }\n  function targetNoComma(_, value) {\n    if (value == \"target\") { cx.marked = \"keyword\"; return cont(maybeoperatorNoComma); }\n  }\n  function maybelabel(type) {\n    if (type == \":\") return cont(poplex, statement);\n    return pass(maybeoperatorComma, expect(\";\"), poplex);\n  }\n  function property(type) {\n    if (type == \"variable\") {cx.marked = \"property\"; return cont();}\n  }\n  function objprop(type, value) {\n    if (type == \"async\") {\n      cx.marked = \"property\";\n      return cont(objprop);\n    } else if (type == \"variable\" || cx.style == \"keyword\") {\n      cx.marked = \"property\";\n      if (value == \"get\" || value == \"set\") return cont(getterSetter);\n      var m // Work around fat-arrow-detection complication for detecting typescript typed arrow params\n      if (isTS && cx.state.fatArrowAt == cx.stream.start && (m = cx.stream.match(/^\\s*:\\s*/, false)))\n        cx.state.fatArrowAt = cx.stream.pos + m[0].length\n      return cont(afterprop);\n    } else if (type == \"number\" || type == \"string\") {\n      cx.marked = (cx.style + \" property\");\n      return cont(afterprop);\n    } else if (type == \"jsonld-keyword\") {\n      return cont(afterprop);\n    } else if (isTS && isModifier(value)) {\n      cx.marked = \"keyword\"\n      return cont(objprop)\n    } else if (type == \"[\") {\n      return cont(expression, maybetype, expect(\"]\"), afterprop);\n    } else if (type == \"spread\") {\n      return cont(expressionNoComma, afterprop);\n    } else if (value == \"*\") {\n      cx.marked = \"keyword\";\n      return cont(objprop);\n    } else if (type == \":\") {\n      return pass(afterprop)\n    }\n  }\n  function getterSetter(type) {\n    if (type != \"variable\") return pass(afterprop);\n    cx.marked = \"property\";\n    return cont(functiondef);\n  }\n  function afterprop(type) {\n    if (type == \":\") return cont(expressionNoComma);\n    if (type == \"(\") return pass(functiondef);\n  }\n  function commasep(what, end, sep) {\n    function proceed(type, value) {\n      if (sep ? sep.indexOf(type) > -1 : type == \",\") {\n        var lex = cx.state.lexical;\n        if (lex.info == \"call\") lex.pos = (lex.pos || 0) + 1;\n        return cont(function(type, value) {\n          if (type == end || value == end) return pass()\n          return pass(what)\n        }, proceed);\n      }\n      if (type == end || value == end) return cont();\n      if (sep && sep.indexOf(\";\") > -1) return pass(what)\n      return cont(expect(end));\n    }\n    return function(type, value) {\n      if (type == end || value == end) return cont();\n      return pass(what, proceed);\n    };\n  }\n  function contCommasep(what, end, info) {\n    for (var i = 3; i < arguments.length; i++)\n      cx.cc.push(arguments[i]);\n    return cont(pushlex(end, info), commasep(what, end), poplex);\n  }\n  function block(type) {\n    if (type == \"}\") return cont();\n    return pass(statement, block);\n  }\n  function maybetype(type, value) {\n    if (isTS) {\n      if (type == \":\") return cont(typeexpr);\n      if (value == \"?\") return cont(maybetype);\n    }\n  }\n  function maybetypeOrIn(type, value) {\n    if (isTS && (type == \":\" || value == \"in\")) return cont(typeexpr)\n  }\n  function mayberettype(type) {\n    if (isTS && type == \":\") {\n      if (cx.stream.match(/^\\s*\\w+\\s+is\\b/, false)) return cont(expression, isKW, typeexpr)\n      else return cont(typeexpr)\n    }\n  }\n  function isKW(_, value) {\n    if (value == \"is\") {\n      cx.marked = \"keyword\"\n      return cont()\n    }\n  }\n  function typeexpr(type, value) {\n    if (value == \"keyof\" || value == \"typeof\" || value == \"infer\") {\n      cx.marked = \"keyword\"\n      return cont(value == \"typeof\" ? expressionNoComma : typeexpr)\n    }\n    if (type == \"variable\" || value == \"void\") {\n      cx.marked = \"type\"\n      return cont(afterType)\n    }\n    if (value == \"|\" || value == \"&\") return cont(typeexpr)\n    if (type == \"string\" || type == \"number\" || type == \"atom\") return cont(afterType);\n    if (type == \"[\") return cont(pushlex(\"]\"), commasep(typeexpr, \"]\", \",\"), poplex, afterType)\n    if (type == \"{\") return cont(pushlex(\"}\"), commasep(typeprop, \"}\", \",;\"), poplex, afterType)\n    if (type == \"(\") return cont(commasep(typearg, \")\"), maybeReturnType, afterType)\n    if (type == \"<\") return cont(commasep(typeexpr, \">\"), typeexpr)\n  }\n  function maybeReturnType(type) {\n    if (type == \"=>\") return cont(typeexpr)\n  }\n  function typeprop(type, value) {\n    if (type == \"variable\" || cx.style == \"keyword\") {\n      cx.marked = \"property\"\n      return cont(typeprop)\n    } else if (value == \"?\" || type == \"number\" || type == \"string\") {\n      return cont(typeprop)\n    } else if (type == \":\") {\n      return cont(typeexpr)\n    } else if (type == \"[\") {\n      return cont(expect(\"variable\"), maybetypeOrIn, expect(\"]\"), typeprop)\n    } else if (type == \"(\") {\n      return pass(functiondecl, typeprop)\n    }\n  }\n  function typearg(type, value) {\n    if (type == \"variable\" && cx.stream.match(/^\\s*[?:]/, false) || value == \"?\") return cont(typearg)\n    if (type == \":\") return cont(typeexpr)\n    if (type == \"spread\") return cont(typearg)\n    return pass(typeexpr)\n  }\n  function afterType(type, value) {\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, afterType)\n    if (value == \"|\" || type == \".\" || value == \"&\") return cont(typeexpr)\n    if (type == \"[\") return cont(typeexpr, expect(\"]\"), afterType)\n    if (value == \"extends\" || value == \"implements\") { cx.marked = \"keyword\"; return cont(typeexpr) }\n    if (value == \"?\") return cont(typeexpr, expect(\":\"), typeexpr)\n  }\n  function maybeTypeArgs(_, value) {\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeexpr, \">\"), poplex, afterType)\n  }\n  function typeparam() {\n    return pass(typeexpr, maybeTypeDefault)\n  }\n  function maybeTypeDefault(_, value) {\n    if (value == \"=\") return cont(typeexpr)\n  }\n  function vardef(_, value) {\n    if (value == \"enum\") {cx.marked = \"keyword\"; return cont(enumdef)}\n    return pass(pattern, maybetype, maybeAssign, vardefCont);\n  }\n  function pattern(type, value) {\n    if (isTS && isModifier(value)) { cx.marked = \"keyword\"; return cont(pattern) }\n    if (type == \"variable\") { register(value); return cont(); }\n    if (type == \"spread\") return cont(pattern);\n    if (type == \"[\") return contCommasep(eltpattern, \"]\");\n    if (type == \"{\") return contCommasep(proppattern, \"}\");\n  }\n  function proppattern(type, value) {\n    if (type == \"variable\" && !cx.stream.match(/^\\s*:/, false)) {\n      register(value);\n      return cont(maybeAssign);\n    }\n    if (type == \"variable\") cx.marked = \"property\";\n    if (type == \"spread\") return cont(pattern);\n    if (type == \"}\") return pass();\n    if (type == \"[\") return cont(expression, expect(']'), expect(':'), proppattern);\n    return cont(expect(\":\"), pattern, maybeAssign);\n  }\n  function eltpattern() {\n    return pass(pattern, maybeAssign)\n  }\n  function maybeAssign(_type, value) {\n    if (value == \"=\") return cont(expressionNoComma);\n  }\n  function vardefCont(type) {\n    if (type == \",\") return cont(vardef);\n  }\n  function maybeelse(type, value) {\n    if (type == \"keyword b\" && value == \"else\") return cont(pushlex(\"form\", \"else\"), statement, poplex);\n  }\n  function forspec(type, value) {\n    if (value == \"await\") return cont(forspec);\n    if (type == \"(\") return cont(pushlex(\")\"), forspec1, poplex);\n  }\n  function forspec1(type) {\n    if (type == \"var\") return cont(vardef, forspec2);\n    if (type == \"variable\") return cont(forspec2);\n    return pass(forspec2)\n  }\n  function forspec2(type, value) {\n    if (type == \")\") return cont()\n    if (type == \";\") return cont(forspec2)\n    if (value == \"in\" || value == \"of\") { cx.marked = \"keyword\"; return cont(expression, forspec2) }\n    return pass(expression, forspec2)\n  }\n  function functiondef(type, value) {\n    if (value == \"*\") {cx.marked = \"keyword\"; return cont(functiondef);}\n    if (type == \"variable\") {register(value); return cont(functiondef);}\n    if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, mayberettype, statement, popcontext);\n    if (isTS && value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, functiondef)\n  }\n  function functiondecl(type, value) {\n    if (value == \"*\") {cx.marked = \"keyword\"; return cont(functiondecl);}\n    if (type == \"variable\") {register(value); return cont(functiondecl);}\n    if (type == \"(\") return cont(pushcontext, pushlex(\")\"), commasep(funarg, \")\"), poplex, mayberettype, popcontext);\n    if (isTS && value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, functiondecl)\n  }\n  function typename(type, value) {\n    if (type == \"keyword\" || type == \"variable\") {\n      cx.marked = \"type\"\n      return cont(typename)\n    } else if (value == \"<\") {\n      return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex)\n    }\n  }\n  function funarg(type, value) {\n    if (value == \"@\") cont(expression, funarg)\n    if (type == \"spread\") return cont(funarg);\n    if (isTS && isModifier(value)) { cx.marked = \"keyword\"; return cont(funarg); }\n    if (isTS && type == \"this\") return cont(maybetype, maybeAssign)\n    return pass(pattern, maybetype, maybeAssign);\n  }\n  function classExpression(type, value) {\n    // Class expressions may have an optional name.\n    if (type == \"variable\") return className(type, value);\n    return classNameAfter(type, value);\n  }\n  function className(type, value) {\n    if (type == \"variable\") {register(value); return cont(classNameAfter);}\n  }\n  function classNameAfter(type, value) {\n    if (value == \"<\") return cont(pushlex(\">\"), commasep(typeparam, \">\"), poplex, classNameAfter)\n    if (value == \"extends\" || value == \"implements\" || (isTS && type == \",\")) {\n      if (value == \"implements\") cx.marked = \"keyword\";\n      return cont(isTS ? typeexpr : expression, classNameAfter);\n    }\n    if (type == \"{\") return cont(pushlex(\"}\"), classBody, poplex);\n  }\n  function classBody(type, value) {\n    if (type == \"async\" ||\n        (type == \"variable\" &&\n         (value == \"static\" || value == \"get\" || value == \"set\" || (isTS && isModifier(value))) &&\n         cx.stream.match(/^\\s+[\\w$\\xa1-\\uffff]/, false))) {\n      cx.marked = \"keyword\";\n      return cont(classBody);\n    }\n    if (type == \"variable\" || cx.style == \"keyword\") {\n      cx.marked = \"property\";\n      return cont(classfield, classBody);\n    }\n    if (type == \"number\" || type == \"string\") return cont(classfield, classBody);\n    if (type == \"[\")\n      return cont(expression, maybetype, expect(\"]\"), classfield, classBody)\n    if (value == \"*\") {\n      cx.marked = \"keyword\";\n      return cont(classBody);\n    }\n    if (isTS && type == \"(\") return pass(functiondecl, classBody)\n    if (type == \";\" || type == \",\") return cont(classBody);\n    if (type == \"}\") return cont();\n    if (value == \"@\") return cont(expression, classBody)\n  }\n  function classfield(type, value) {\n    if (value == \"?\") return cont(classfield)\n    if (type == \":\") return cont(typeexpr, maybeAssign)\n    if (value == \"=\") return cont(expressionNoComma)\n    var context = cx.state.lexical.prev, isInterface = context && context.info == \"interface\"\n    return pass(isInterface ? functiondecl : functiondef)\n  }\n  function afterExport(type, value) {\n    if (value == \"*\") { cx.marked = \"keyword\"; return cont(maybeFrom, expect(\";\")); }\n    if (value == \"default\") { cx.marked = \"keyword\"; return cont(expression, expect(\";\")); }\n    if (type == \"{\") return cont(commasep(exportField, \"}\"), maybeFrom, expect(\";\"));\n    return pass(statement);\n  }\n  function exportField(type, value) {\n    if (value == \"as\") { cx.marked = \"keyword\"; return cont(expect(\"variable\")); }\n    if (type == \"variable\") return pass(expressionNoComma, exportField);\n  }\n  function afterImport(type) {\n    if (type == \"string\") return cont();\n    if (type == \"(\") return pass(expression);\n    return pass(importSpec, maybeMoreImports, maybeFrom);\n  }\n  function importSpec(type, value) {\n    if (type == \"{\") return contCommasep(importSpec, \"}\");\n    if (type == \"variable\") register(value);\n    if (value == \"*\") cx.marked = \"keyword\";\n    return cont(maybeAs);\n  }\n  function maybeMoreImports(type) {\n    if (type == \",\") return cont(importSpec, maybeMoreImports)\n  }\n  function maybeAs(_type, value) {\n    if (value == \"as\") { cx.marked = \"keyword\"; return cont(importSpec); }\n  }\n  function maybeFrom(_type, value) {\n    if (value == \"from\") { cx.marked = \"keyword\"; return cont(expression); }\n  }\n  function arrayLiteral(type) {\n    if (type == \"]\") return cont();\n    return pass(commasep(expressionNoComma, \"]\"));\n  }\n  function enumdef() {\n    return pass(pushlex(\"form\"), pattern, expect(\"{\"), pushlex(\"}\"), commasep(enummember, \"}\"), poplex, poplex)\n  }\n  function enummember() {\n    return pass(pattern, maybeAssign);\n  }\n\n  function isContinuedStatement(state, textAfter) {\n    return state.lastType == \"operator\" || state.lastType == \",\" ||\n      isOperatorChar.test(textAfter.charAt(0)) ||\n      /[,.]/.test(textAfter.charAt(0));\n  }\n\n  function expressionAllowed(stream, state, backUp) {\n    return state.tokenize == tokenBase &&\n      /^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\\[{}\\(,;:]|=>)$/.test(state.lastType) ||\n      (state.lastType == \"quasi\" && /\\{\\s*$/.test(stream.string.slice(0, stream.pos - (backUp || 0))))\n  }\n\n  // Interface\n\n  return {\n    startState: function(basecolumn) {\n      var state = {\n        tokenize: tokenBase,\n        lastType: \"sof\",\n        cc: [],\n        lexical: new JSLexical((basecolumn || 0) - indentUnit, 0, \"block\", false),\n        localVars: parserConfig.localVars,\n        context: parserConfig.localVars && new Context(null, null, false),\n        indented: basecolumn || 0\n      };\n      if (parserConfig.globalVars && typeof parserConfig.globalVars == \"object\")\n        state.globalVars = parserConfig.globalVars;\n      return state;\n    },\n\n    token: function(stream, state) {\n      if (stream.sol()) {\n        if (!state.lexical.hasOwnProperty(\"align\"))\n          state.lexical.align = false;\n        state.indented = stream.indentation();\n        findFatArrow(stream, state);\n      }\n      if (state.tokenize != tokenComment && stream.eatSpace()) return null;\n      var style = state.tokenize(stream, state);\n      if (type == \"comment\") return style;\n      state.lastType = type == \"operator\" && (content == \"++\" || content == \"--\") ? \"incdec\" : type;\n      return parseJS(state, style, type, content, stream);\n    },\n\n    indent: function(state, textAfter) {\n      if (state.tokenize == tokenComment) return CodeMirror.Pass;\n      if (state.tokenize != tokenBase) return 0;\n      var firstChar = textAfter && textAfter.charAt(0), lexical = state.lexical, top\n      // Kludge to prevent 'maybelse' from blocking lexical scope pops\n      if (!/^\\s*else\\b/.test(textAfter)) for (var i = state.cc.length - 1; i >= 0; --i) {\n        var c = state.cc[i];\n        if (c == poplex) lexical = lexical.prev;\n        else if (c != maybeelse) break;\n      }\n      while ((lexical.type == \"stat\" || lexical.type == \"form\") &&\n             (firstChar == \"}\" || ((top = state.cc[state.cc.length - 1]) &&\n                                   (top == maybeoperatorComma || top == maybeoperatorNoComma) &&\n                                   !/^[,\\.=+\\-*:?[\\(]/.test(textAfter))))\n        lexical = lexical.prev;\n      if (statementIndent && lexical.type == \")\" && lexical.prev.type == \"stat\")\n        lexical = lexical.prev;\n      var type = lexical.type, closing = firstChar == type;\n\n      if (type == \"vardef\") return lexical.indented + (state.lastType == \"operator\" || state.lastType == \",\" ? lexical.info.length + 1 : 0);\n      else if (type == \"form\" && firstChar == \"{\") return lexical.indented;\n      else if (type == \"form\") return lexical.indented + indentUnit;\n      else if (type == \"stat\")\n        return lexical.indented + (isContinuedStatement(state, textAfter) ? statementIndent || indentUnit : 0);\n      else if (lexical.info == \"switch\" && !closing && parserConfig.doubleIndentSwitch != false)\n        return lexical.indented + (/^(?:case|default)\\b/.test(textAfter) ? indentUnit : 2 * indentUnit);\n      else if (lexical.align) return lexical.column + (closing ? 0 : 1);\n      else return lexical.indented + (closing ? 0 : indentUnit);\n    },\n\n    electricInput: /^\\s*(?:case .*?:|default:|\\{|\\})$/,\n    blockCommentStart: jsonMode ? null : \"/*\",\n    blockCommentEnd: jsonMode ? null : \"*/\",\n    blockCommentContinue: jsonMode ? null : \" * \",\n    lineComment: jsonMode ? null : \"//\",\n    fold: \"brace\",\n    closeBrackets: \"()[]{}''\\\"\\\"``\",\n\n    helperType: jsonMode ? \"json\" : \"javascript\",\n    jsonldMode: false,\n    jsonMode: jsonMode,\n\n    expressionAllowed: expressionAllowed,\n\n    skipExpression: function(state) {\n      var top = state.cc[state.cc.length - 1]\n      if (top == expression || top == expressionNoComma) state.cc.pop()\n    }\n  };\n});\n\nCodeMirror.registerHelper(\"wordChars\", \"javascript\", /[\\w$]/);\n\nCodeMirror.defineMIME(\"text/javascript\", \"javascript\");\nCodeMirror.defineMIME(\"text/ecmascript\", \"javascript\");\nCodeMirror.defineMIME(\"application/javascript\", \"javascript\");\nCodeMirror.defineMIME(\"application/x-javascript\", \"javascript\");\nCodeMirror.defineMIME(\"application/ecmascript\", \"javascript\");\nCodeMirror.defineMIME(\"application/json\", {name: \"javascript\", json: true});\nCodeMirror.defineMIME(\"application/lsystem\", {name: \"javascript\", json: true, lsystem: true});\nCodeMirror.defineMIME(\"application/x-json\", {name: \"javascript\", json: true});\nCodeMirror.defineMIME(\"application/ld+json\", {name: \"javascript\", jsonld: true});\nCodeMirror.defineMIME(\"text/typescript\", { name: \"javascript\", typescript: true });\nCodeMirror.defineMIME(\"application/typescript\", { name: \"javascript\", typescript: true });\n}"],"sourceRoot":""}